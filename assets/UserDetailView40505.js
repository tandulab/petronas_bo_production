import{d as ne,b as f,e as _,f as h,h as o,z as u,C as j,A as y,am as ie,g as s,m as E,ar as re,as as de,r as v,q as ce,af as ue,u as me,c as k,n as _e,a as pe,i as G,j as g}from"./usetoast.esm40505.js";import{e as U,a as S,s as A,h as p}from"./helpers40505.js";import{u as fe}from"./user40505.js";import{u as ve}from"./useconfirm.esm40505.js";import{f as ye}from"./formatData40505.js";import{_ as K}from"./_plugin-vue_export-helper40505.js";import"./datetime40505.js";const he=V=>(re("data-v-107317f4"),V=V(),de(),V),be=he(()=>s("i",{class:"pi pi-sync"},null,-1)),ge=[be],Ve=ne({__name:"UserEventsTable",props:{events:null},setup(V){function t(C){switch(C){case"VIDEOPILLS_VAI_AL_VIDEO":return"Hai visto una video pillola";case"VIDEOPILLS_QUIZ":return"Hai fatto un quiz di una video pillola";case"VIDEOPILLS_ALLEGATI":return"Hai aperto un allegato di una video pillola";case"SONDAGGI_RISPONDI":return"Hai risposto ad un sondaggio";case"NEWS_VOTA_OK_O_KO":return"Hai votato una news";case"NEWS_LEGGI_DI_PIU":return"Hai letto una news";case"CONTATTI_INSERISCI_I_DATI":return"Ci hai contattato";case"APRI_OBIETTIVI":return"Hai aperto gli obiettivi";default:return C}}return(C,e)=>{const w=f("Column"),D=f("DataTable");return _(),h("div",null,[o(D,{value:V.events},{empty:u(()=>[j(" No events found.")]),default:u(()=>[o(w,{field:"event_type"},{body:u(({data:m})=>[j(y(t(m.event_type)),1)]),_:1}),o(w,{field:"description"}),o(w,{field:"created_at"},{body:u(({data:m})=>[j(y(ie(ye)(m.created_at)),1)]),_:1}),o(w,{field:"coins"},{body:u(({data:m})=>[j(y(m.coins)+" coins",1)]),_:1}),o(w,{field:"synced"},{body:u(({data:m})=>[s("div",{class:E(["sync-icon",{synced:m.synced}])},ge,2)]),_:1})]),_:1},8,["value"])])}}});const Ce=K(Ve,[["__scopeId","data-v-107317f4"]]),we={setup(){const V=v({icon:"pi pi-home",to:"/users"}),t=v(""),C=v([{label:""}]),e=v({}),w=v([{label:"Enabled",value:!0},{label:"Disabled",value:!1}]),D=v(),m=v(!1),b=ce(),n=ue(),i=fe(),d=me(),x=ve(),z=v(!1),P=v(!1),B=v(!1),I=v(!1),l=k(()=>i.getCurrentUser),R=k(()=>i.userRoles),N=k(()=>i.userRolesItaly),O=k(()=>i.allUsers),T=k(()=>d.getSelectedCountry),r=k(()=>i.getResponseCredentials),Z=k(()=>i.getUserEvents),H=async function(a){A();try{await i.fetchUserDetail(a),J()}catch(c){U(n,c)}finally{p()}},M=async function(a){const c=new Map;a&&c.set("sellout_code",a.query),T.value.country_code!="IT"?c.set("role","dealer"):e.value.role=="user"?c.set("role","agent"):e.value.role=="agent"?c.set("role","dealer"):e.value.role=="dealer"&&c.set("role","vendor"),c.set("country_id",T.value.id),await i.fetchAllUsers(c).catch(F=>{U(n,F)})},Q=async function(){var F;e.value.parent&&(e.value.parent_id=e.value.parent.id);const a=Object.assign({},e.value);a.email==""&&((F=l.value.email)!=null&&F.includes("fake"))&&(a.email=l.value.email);const c={user:a};i.updateUser(c).then(()=>{p(),H(l.value.id+""),S(n,{message:"User updated correctly.",title:""})}).catch(ae=>{p(),U(n,ae)})},Y=async function(){const a={user:e.value};i.createUser(a).then(()=>{p(),H(l.value.id+""),S(n,{message:"User created correctly.",title:""}),pe.push({name:"user-detail",params:{id:l.value.id}})}).catch(c=>{p(),U(n,c)})},J=function(){var a;e.value=Object.assign({},l.value),e.value.country_id=(a=l.value.country)==null?void 0:a.id,delete e.value.country,l.value.email&&l.value.email.includes("fake")&&(e.value.email="")},X=function(){L(e.value.role),L(e.value.sellout_code),L(e.value.company_name)},$=function(){if(m.value=!0,X(),e.value.parent&&(e.value.parent_id=e.value.parent.id),I.value){S(n,{message:"Check that you have completed the required fields.",title:"",error:!0});return}t.value!=""||e.value.id?Q():Y(),m.value=!1,A()},L=function(a){if(m.value)return a==""||a==null?I.value=!0:I.value=!1,I.value},ee=async function(){i.disableUser(e.value.id+"",e.value.enabled).then(()=>{p(),e.value.enabled?S(n,{message:"User successfully enabled.",title:""}):S(n,{message:"User successfully disabled.",title:""})}).catch(a=>{p(),U(n,a)})},se=a=>{x.require({group:"credentials",target:a.currentTarget,message:"Are you sure you want to recover password?",icon:"pi pi-exclamation-triangle"})},le=a=>{x.require({group:"first_credentials",target:a.currentTarget,message:"Are you sure you want to send credentials?",icon:"pi pi-exclamation-triangle"})},te=async function(){A(),await i.sendCredentials(l.value.id+"").then(()=>{r.value&&r.value.sent?n.add({summary:"Email sent successfully",detail:"Temporary password: "+r.value.temp_password,closable:!0,severity:"success"}):r.value.sent||n.add({summary:"Email was not sent",detail:"Temporary password: "+r.value.temp_password,closable:!0,severity:"warn"}),q(),p()}).catch(a=>{p(),U(n,a)})},oe=async function(){A(),await i.sendFirstCredentials(l.value.id+"").then(()=>{r.value&&r.value.sent?n.add({summary:"Email sent successfully",detail:"Temporary password: "+r.value.temp_password,closable:!0,severity:"success"}):r.value.sent||n.add({summary:"Email was not sent",detail:"Temporary password: "+r.value.temp_password,closable:!0,severity:"warn"}),q(),p()}).catch(a=>{p(),U(n,a)})},q=function(){var a=document.getElementsByClassName("p-confirm-dialog-reject")[0];a&&a.click()},W=async function(a){try{A(),await i.fetchUserEvents(a)}catch(c){U(n,c)}finally{p()}};return _e(async()=>{M(null),t.value=b.params.id+"",t.value!=""&&t.value!="undefined"?(H(t.value).then(()=>{e.value.language_code==="it"&&W(t.value)}),C.value[0]={label:"Edit user"}):(C.value[0]={label:"New user"},e.value.country_id=T.value.id)}),{home:V,items:C,tmp_user:e,invalid_cluster:z,invalid_original_sellout_code:P,invalid_phone:B,filteredUsers:D,allUsers:O,user_status:w,userRoles:R,userRolesItaly:N,selectedCountry:T,userEvents:Z,saveUser:$,validateField:L,fetchAllUsers:M,disableUser:ee,confirmSendCredentials:se,confirmSendFirstCredentials:le,sendCredentials:te,closePopup:q,sendFirstCredentials:oe,fetchUserEvents:W}},components:{UserEventsTable:Ce}};const xe={class:"m-4"},Ue={class:"flex justify-content-between align-items-center mb-3"},Ie={class:"flex align-items-center justify-content-between"},Te=s("h2",{class:"mb-2"},"USER DETAILS",-1),ke={key:0,class:"field col-4 mb-0 flex align-items-center justify-content-end"},Ee={key:0,class:"field-checkbox pt-3"},Se=s("label",{for:"out_of_network"},"Out of network",-1),Ae={class:"col-offset-1"},De={class:"formgrid grid col-10 px-0"},Re={class:"field col-6"},Ne=s("label",{for:"cluster"},"Cluster*",-1),Oe={key:0,class:"p-error"},Le={class:"field col-6"},Fe=s("label",{for:"name"},"Full name",-1),je={class:"field col-6"},ze=s("label",{for:"phone"},"Phone",-1),Pe={class:"field col-6"},Be=s("label",{for:"name"},"Email",-1),He={class:"field col-6"},qe=s("label",{for:"company"},"Company*",-1),Ge={key:0,class:"p-error"},Me={class:"field col-6"},We=s("label",{for:"name"},"Vat code",-1),Ke=s("div",{class:"flex align-items-center justify-content-between"},[s("h2",{class:"mb-2"},"CUSTOMER DATA")],-1),Ze={class:"formgrid grid col-10 px-0"},Qe={class:"field col-6"},Ye=s("label",{for:"sellout_code"},"Actual customer code*",-1),Je={key:0,class:"p-error"},Xe={class:"field col-6 flex flex-column"},$e=s("label",{for:"original_sellout_code"},"Original customer code",-1),es=s("div",{class:"flex align-items-center justify-content-between"},[s("h2",{class:"mb-2"},"DELIVERY ADDRESS")],-1),ss={class:"formgrid grid col-10 px-0"},ls={class:"field col-6"},ts=s("label",{for:"shipping_name"},"Recipient",-1),os=s("div",{class:"col-6"},null,-1),as={class:"field col-6"},ns=s("label",{for:"shipping_city"},"City",-1),is={class:"field col-3"},rs=s("label",{for:"shipping_province"},"Province",-1),ds={class:"field col-2"},cs=s("label",{for:"shipping_zip"},"Zip code",-1),us={class:"field col-6"},ms=s("label",{for:"shipping_zip"},"Address",-1),_s={class:"field col-3"},ps=s("label",{for:"shipping_number"},"Number",-1),fs={class:"field col-12"},vs=s("label",{for:"shipping_note"},"Note",-1),ys=s("div",{class:"flex align-items-center justify-content-between"},[s("h2",{class:"mb-2"},"MORE DATA")],-1),hs={class:"formgrid grid col-10 px-0"},bs={class:"field col-6 flex flex-column"},gs=s("label",{for:"original_sellout_code"},"User parent",-1),Vs=s("div",{class:"col-6"},null,-1),Cs={key:0},ws=s("div",{class:"flex align-items-center justify-content-between col-12"},[s("h2",{class:"mb-3"},"PARENT DETAIL")],-1),xs={class:"field flex col-12"},Us=s("div",{class:"flex flex-column mr-2 line-height-3"},[s("span",{class:"mb-1"},"Sellout code: "),s("span",{class:"mb-1"},"Company:"),s("span",{class:"mb-1"},"Email: "),s("span",{class:"mb-1"},"Role:")],-1),Is={class:"flex flex-column line-height-3"},Ts={class:"mb-1"},ks={class:"mb-1"},Es={class:"mb-1"},Ss={key:0,class:"capitalize"},As={key:1,class:"capitalize"},Ds=s("div",{class:"flex align-items-center justify-content-between"},[s("h2",{class:"mb-2"},"GAMIFICATION")],-1),Rs={class:"flex p-3 align-items-center"},Ns={class:"pl-2"},Os={class:"flex align-items-center pb-3 justify-content-end"},Ls={class:"flex p-3 align-items-center"},Fs={class:"pl-2"},js={class:"flex align-items-center pb-3 justify-content-end"};function zs(V,t,C,e,w,D){const m=f("Breadcrumb"),b=f("Button"),n=f("Checkbox"),i=f("Dropdown"),d=f("InputText"),x=f("Card"),z=f("Textarea"),P=f("AutoComplete"),B=f("UserEventsTable"),I=f("ConfirmPopup");return _(),h("div",xe,[s("div",Ue,[o(m,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"]),s("div",null,[e.tmp_user.id&&e.tmp_user.role=="user"?(_(),G(b,{key:0,label:"Send first credentials",onClick:t[0]||(t[0]=l=>e.confirmSendFirstCredentials(l)),class:"p-button-outlined mr-3",icon:"pi pi-envelope"})):g("",!0),e.tmp_user.id?(_(),G(b,{key:1,label:"Recover password",onClick:t[1]||(t[1]=l=>e.confirmSendCredentials(l)),class:"p-button-outlined mr-3",icon:"pi pi-envelope"})):g("",!0),o(b,{label:"Save",onClick:e.saveUser},null,8,["onClick"])])]),o(x,null,{content:u(()=>[s("div",Ie,[Te,e.tmp_user.id?(_(),h("div",ke,[e.selectedCountry&&e.selectedCountry.country_code=="IT"?(_(),h("div",Ee,[o(n,{"input-id":"out_of_network",binary:"",modelValue:e.tmp_user.out_of_network,"onUpdate:modelValue":t[2]||(t[2]=l=>e.tmp_user.out_of_network=l)},null,8,["modelValue"]),Se])):g("",!0),s("div",Ae,[o(i,{modelValue:e.tmp_user.enabled,"onUpdate:modelValue":t[3]||(t[3]=l=>e.tmp_user.enabled=l),options:e.user_status,class:"w-full capitalize dropdown-status",optionLabel:"label",optionValue:"value",onChange:t[4]||(t[4]=l=>e.disableUser()),style:{"max-width":"200px"}},null,8,["modelValue","options"])])])):g("",!0)]),s("div",De,[s("div",Re,[Ne,o(i,{modelValue:e.tmp_user.role,"onUpdate:modelValue":t[5]||(t[5]=l=>e.tmp_user.role=l),options:e.selectedCountry.country_code=="IT"?e.userRolesItaly:e.userRoles,optionLabel:"name",optionValue:"value",id:"cluster",class:E(["w-full",{"p-invalid":e.validateField(e.tmp_user.role)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_user.role)?(_(),h("small",Oe,"Campo obbligatorio.")):g("",!0)]),s("div",Le,[Fe,o(d,{id:"name",type:"text",modelValue:e.tmp_user.full_name,"onUpdate:modelValue":t[6]||(t[6]=l=>e.tmp_user.full_name=l),class:"w-full"},null,8,["modelValue"])]),s("div",je,[ze,o(d,{id:"phone",type:"text",modelValue:e.tmp_user.phone,"onUpdate:modelValue":t[7]||(t[7]=l=>e.tmp_user.phone=l),class:"w-full"},null,8,["modelValue"])]),s("div",Pe,[Be,o(d,{id:"name",type:"text",modelValue:e.tmp_user.email,"onUpdate:modelValue":t[8]||(t[8]=l=>e.tmp_user.email=l),class:"w-full"},null,8,["modelValue"])]),s("div",He,[qe,o(d,{id:"company_name",type:"text",modelValue:e.tmp_user.company_name,"onUpdate:modelValue":t[9]||(t[9]=l=>e.tmp_user.company_name=l),class:E(["w-full",{"p-invalid":e.validateField(e.tmp_user.company_name)}])},null,8,["modelValue","class"]),e.validateField(e.tmp_user.company_name)?(_(),h("small",Ge,"Campo obbligatorio.")):g("",!0)]),s("div",Me,[We,o(d,{id:"name",type:"text",modelValue:e.tmp_user.vat_cf,"onUpdate:modelValue":t[10]||(t[10]=l=>e.tmp_user.vat_cf=l),class:"w-full"},null,8,["modelValue"])])])]),_:1}),o(x,{class:"mt-4"},{content:u(()=>[Ke,s("div",Ze,[s("div",Qe,[Ye,o(d,{id:"sellout_code",type:"text",modelValue:e.tmp_user.sellout_code,"onUpdate:modelValue":t[11]||(t[11]=l=>e.tmp_user.sellout_code=l),class:E(["w-full",{"p-invalid":e.validateField(e.tmp_user.original_sellout_code)}])},null,8,["modelValue","class"]),e.validateField(e.tmp_user.sellout_code)?(_(),h("small",Je,"Campo obbligatorio.")):g("",!0)]),s("div",Xe,[$e,o(d,{id:"original_sellout_code",type:"text",modelValue:e.tmp_user.original_sellout_code,"onUpdate:modelValue":t[12]||(t[12]=l=>e.tmp_user.original_sellout_code=l)},null,8,["modelValue"])])])]),_:1}),o(x,{class:"mt-4"},{content:u(()=>[es,s("div",ss,[s("div",ls,[ts,o(d,{id:"shipping_name",type:"text",modelValue:e.tmp_user.shipping_name,"onUpdate:modelValue":t[13]||(t[13]=l=>e.tmp_user.shipping_name=l),class:"w-full"},null,8,["modelValue"])]),os,s("div",as,[ns,o(d,{id:"shipping_city",type:"text",modelValue:e.tmp_user.shipping_city,"onUpdate:modelValue":t[14]||(t[14]=l=>e.tmp_user.shipping_city=l),class:"w-full"},null,8,["modelValue"])]),s("div",is,[rs,o(d,{id:"shipping_province",type:"text",modelValue:e.tmp_user.shipping_province,"onUpdate:modelValue":t[15]||(t[15]=l=>e.tmp_user.shipping_province=l),class:"w-full"},null,8,["modelValue"])]),s("div",ds,[cs,o(d,{id:"shipping_zip",type:"text",modelValue:e.tmp_user.shipping_zip,"onUpdate:modelValue":t[16]||(t[16]=l=>e.tmp_user.shipping_zip=l),class:"w-full"},null,8,["modelValue"])]),s("div",us,[ms,o(d,{id:"shipping_zip",type:"text",modelValue:e.tmp_user.shipping_address,"onUpdate:modelValue":t[17]||(t[17]=l=>e.tmp_user.shipping_address=l),class:"w-full"},null,8,["modelValue"])]),s("div",_s,[ps,o(d,{id:"shipping_number",type:"text",modelValue:e.tmp_user.shipping_number,"onUpdate:modelValue":t[18]||(t[18]=l=>e.tmp_user.shipping_number=l),class:"w-full"},null,8,["modelValue"])]),s("div",fs,[vs,o(z,{modelValue:e.tmp_user.shipping_note,"onUpdate:modelValue":t[19]||(t[19]=l=>e.tmp_user.shipping_note=l),rows:"5",cols:"30",class:"w-full"},null,8,["modelValue"])])])]),_:1}),o(x,{class:"mt-4"},{content:u(()=>{var l,R,N,O,T;return[ys,s("div",hs,[s("div",bs,[gs,o(P,{modelValue:e.tmp_user.parent,"onUpdate:modelValue":t[20]||(t[20]=r=>e.tmp_user.parent=r),suggestions:e.allUsers,onComplete:t[21]||(t[21]=r=>e.fetchAllUsers(r)),optionLabel:"sellout_code",optionValude:"id",emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",disabled:!e.tmp_user.role,placeholder:"Search by sellout code"},{item:u(r=>[s("div",null,y(r.item.sellout_code)+" - "+y(r.item.company_name),1)]),_:1},8,["modelValue","suggestions","disabled"])]),Vs,e.tmp_user.parent?(_(),h("div",Cs,[ws,s("div",xs,[Us,s("div",Is,[s("span",Ts,y(((l=e.tmp_user.parent)==null?void 0:l.sellout_code)||"-"),1),s("span",ks,y(((R=e.tmp_user.parent)==null?void 0:R.company_name)||"-"),1),s("span",Es,y(((N=e.tmp_user.parent)==null?void 0:N.email)||"-"),1),((O=e.tmp_user.parent)==null?void 0:O.role)=="dealer"?(_(),h("span",Ss,"Distributor")):(_(),h("span",As,y(((T=e.tmp_user.parent)==null?void 0:T.role)||"-"),1))])])])):g("",!0)])]}),_:1}),e.tmp_user.language_code==="it"?(_(),G(x,{key:0,class:"mt-4"},{content:u(()=>[Ds,o(B,{events:e.userEvents,class:"my-2"},null,8,["events"])]),_:1})):g("",!0),o(I,{group:"credentials",id:"credentials"},{message:u(l=>[s("div",Rs,[s("i",{class:E(l.message.icon),style:{"font-size":"1.5rem"}},null,2),s("p",Ns,y(l.message.message),1)]),s("div",Os,[o(b,{label:"Cancel",class:"mr-3 p-button-text text-500",onClick:e.closePopup},null,8,["onClick"]),o(b,{label:"Send",class:"mr-4",onClick:e.sendCredentials},null,8,["onClick"])])]),_:1}),o(I,{group:"first_credentials",id:"first_credentials"},{message:u(l=>[s("div",Ls,[s("i",{class:E(l.message.icon),style:{"font-size":"1.5rem"}},null,2),s("p",Fs,y(l.message.message),1)]),s("div",js,[o(b,{label:"Cancel",class:"mr-3 p-button-text text-500",onClick:e.closePopup},null,8,["onClick"]),o(b,{label:"Send",class:"mr-4",onClick:e.sendFirstCredentials},null,8,["onClick"])])]),_:1})])}const Ks=K(we,[["render",zs]]);export{Ks as default};

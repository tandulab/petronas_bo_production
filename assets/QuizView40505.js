import{w as ce}from"./runtime-dom.esm-bundler40505.js";import{u as P}from"./quiz40505.js";import{d as j,af as de,u as pe,r as f,c as Q,o as me,b as n,l as ve,e as b,f as g,h as a,z as s,C as M,A as u,am as l,j as T,g as c,m as _e,w as $,a as fe,ag as he}from"./usetoast.esm40505.js";import{e as q,s as S,a as ye,h as D}from"./helpers40505.js";import{c as be,a as A}from"./formatData40505.js";import{u as ge}from"./useconfirm.esm40505.js";import"./datetime40505.js";const we={key:0},ze=c("div",{class:"text-center"},"Quiz",-1),Ce={class:"text-center"},xe={style:{"min-width":"145px"}},De={class:"col-12 flex"},Qe={key:0,class:"col-8 px-0 mt-3"},ke={class:"text-center font-semibold mb-2 mt-0"},Ve={class:"col-4 flex justify-content-end"},Me={key:1,class:"flex flex-column mt-3"},qe={class:"mb-1"},Be=j({__name:"QuizTable",setup(N){const p=P(),m=de(),B=pe(),C=ge(),w=f(!1),d=f({name:{value:"",matchMode:"contains"},active_from:{value:"",matchMode:"contains"},active_to:{value:"",matchMode:"contains"},company_name:{value:"",matchMode:"contains"},country:{value:"",matchMode:"contains"},status:{value:"",matchMode:"contains"}}),U=f([{label:"Active",value:"active"},{label:"Draft",value:"draft"},{label:"Expired",value:"expired"},{label:"Waiting",value:"waiting"}]),r=f(),E=f(),F=f(!1),v=f(),k=f(),I=Q(()=>B.getSelectedCountry),K=Q(()=>p.getAllQuizzes),W=Q(()=>p.getTotalQuizzes),h=Q(()=>p.getReportQuiz);me(()=>{w.value=!0,r.value={first:0,rows:E.value.rows,sortField:null,sortOrder:null,filters:d.value},x()});const G=async function(t){try{await p.fetchAllQuizzes(t)}catch(o){q(m,o)}finally{w.value=!1}};function x(){w.value=!0;const t=new Map;t.set("country_id",I.value.id),d.value.active_from.value&&t.set("active_from",be(d.value.active_from.value)),t.set("status",d.value.status.value),t.set("page",r.value.page+1),t.set("per_page",r.value.rows),r.value.sortField&&(r.value.sortOrder==1?t.set("sorted_by",r.value.sortField+"_asc"):t.set("sorted_by",r.value.sortField+"_desc")),setTimeout(()=>{G(t)},Math.random()*1e3+250)}const H=t=>{r.value=t,x()},J=t=>{r.value=t,x()},X=()=>{r.value.filters=d.value,x()},Y=function(t){fe.push({name:"quiz-detail",params:{id:t.id}})},Z=(t,o)=>{o.users_counter>0?C.require({target:t.currentTarget,message:"The quiz cannot be deleted because there are associated users.",icon:"pi pi-exclamation-triangle",rejectClass:"hidden",acceptClass:"hidden"}):C.require({target:t.currentTarget,message:"Are you sure you want to remove this quiz?",icon:"pi pi-exclamation-triangle",accept:()=>{ee(o.id)}})},ee=async function(t){S();try{await p.deleteQuiz(t),ye(m,{message:"Quiz deleted correctly.",title:""}),x()}catch(o){q(m,o)}finally{D()}},te=t=>{v.value=t,v.value.typology=="open"?L():(oe(t.id),F.value=!0)},oe=async function(t){S(),p.fetchQuizReport(t).then(()=>{D(),k.value=ae()}).catch(o=>{D(),q(m,o)})},ae=()=>{const t=[],o=[];return h.value&&h.value.answers.forEach(i=>{o.push(i.percentage),t.push(i.text.text)}),{chartData:{datasets:[{data:o,backgroundColor:["#cd1867","#DB4CB3","#EABB3D","#B958D8","#a1c653","#009265"]}],labels:t},chartOptions:{maintainAspectRatio:.5,plugins:{legend:{display:!1},tooltip:{callbacks:{label:i=>`${i.formattedValue}%`}}}}}},L=async function(){S();try{const o=await he({method:"get",url:`/quizzes/${v.value.id}/download_answers`,responseType:"blob"});var t=new Blob([o.data],{type:o.headers["content-type"]});const i=document.createElement("a");i.href=window.URL.createObjectURL(t),i.download="report_quiz.xlsx",i.click(),D()}catch(o){D(),q(m,o)}},O=function(){var o;const t=(o=v.value.country)==null?void 0:o.default_language_code;if(t)return v.value.translations[t].title.text};return(t,o)=>{const i=n("Calendar"),y=n("Column"),se=n("Badge"),le=n("Dropdown"),V=n("Button"),ne=n("DataTable"),re=n("Chart"),ie=n("Dialog"),ue=n("ConfirmPopup"),R=ve("tooltip");return b(),g("div",null,[a(ne,{value:l(K),lazy:!0,ref_key:"dt",ref:E,rows:30,paginator:!0,totalRecords:l(W),onPage:o[0]||(o[0]=e=>H(e)),onSort:o[1]||(o[1]=e=>J(e)),onFilter:X,filterDisplay:"row",filters:d.value,"onUpdate:filters":o[2]||(o[2]=e=>d.value=e),loading:w.value,removableSort:""},{empty:s(()=>[M(" No video pills found ")]),default:s(()=>[a(y,{field:"active_from",header:"Active from",filterMatchMode:"contains",ref:"active_from",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:s(({data:e})=>[M(u(l(A)(e.active_from)),1)]),filter:s(({filterModel:e,filterCallback:_})=>[a(i,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":z=>e.value=z,dateFormat:"dd/mm/yy",onKeydown:ce(z=>_(),["enter"]),manualInput:!1,placeholder:"Filter by data",onDateSelect:z=>_()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),_:1},512),a(y,{field:"active_to",header:"Active to",ref:"active_to",sortable:!1},{body:s(({data:e})=>[M(u(l(A)(e.active_to)),1)]),_:1},512),a(y,{field:"hidden_at",header:"Visible until"},{body:s(({data:e})=>[M(u(l(A)(e.hidden_at)),1)]),_:1}),a(y,{field:"",header:"Title"},{body:s(({data:e})=>[e.translations[e.country.default_language_code]&&e.translations[e.country.default_language_code].title?(b(),g("span",we,u(e.translations[e.country.default_language_code].title.text),1)):T("",!0)]),_:1}),a(y,{header:"",field:"total_results",style:{width:"6rem"}},{header:s(()=>[ze]),body:s(({data:e})=>[c("div",Ce,u(e.total_results??0),1)]),_:1}),a(y,{header:"Status",field:"status",filterMatchMode:"contains",ref:"status",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:s(({data:e})=>[a(se,{value:e.status,class:_e(["px-4 border-round-lg",e.status])},null,8,["value","class"])]),filter:s(({filterModel:e,filterCallback:_})=>[a(le,{modelValue:e.value,"onUpdate:modelValue":z=>e.value=z,options:U.value,optionValue:"value",optionLabel:"label",onChange:z=>_(),placeholder:"Filter by status"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),a(y,{header:""},{body:s(({data:e})=>[c("div",xe,[$(a(V,{type:"button",onClick:_=>Y(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil",disabled:!e.can_edit},null,8,["onClick","disabled"]),[[R,"Edit",void 0,{top:!0}]]),$(a(V,{type:"button",onClick:_=>Z(_,e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-trash",disabled:!e.can_delete},null,8,["onClick","disabled"]),[[R,"Delete",void 0,{top:!0}]]),$(a(V,{type:"button",onClick:_=>te(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-chart-bar"},null,8,["onClick"]),[[R,"Report",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"]),a(ie,{style:{width:"40vw"},visible:F.value,"onUpdate:visible":o[4]||(o[4]=e=>F.value=e),modal:"",header:"Quiz report"},{default:s(()=>[c("div",De,[v.value.typology=="closed"&&v.value.id&&l(h)&&l(h).answers&&k.value?(b(),g("div",Qe,[c("p",ke,u(O())+" - Respondents: "+u(l(h).total),1),a(re,{type:"bar",data:k.value.chartData,options:k.value.chartOptions},null,8,["data","options"])])):T("",!0),c("div",Ve,[a(V,{class:"p-button-outlined p-button-secondary",label:"Report",icon:"pi pi-download",onClick:o[3]||(o[3]=e=>L())})]),v.value.typology=="open"&&l(h)?(b(),g("div",Me,[c("span",qe,"Question: "+u(O()),1),c("span",null,"Respondents: "+u(l(h).total||"-"),1)])):T("",!0)])]),_:1},8,["visible"]),a(ue)])}}}),Fe={class:"flex justify-content-between align-items-center"},Re={class:"uppercase"},Te={key:0},$e={key:1},je=j({__name:"QuizView",setup(N){const p=P(),m=Q(()=>p.getTotalQuizzes);return(B,C)=>{const w=n("Button"),d=n("Card");return b(),g("div",null,[a(d,null,{content:s(()=>[c("div",Fe,[c("h1",Re,[l(m)==1?(b(),g("span",Te," 1 Video pill")):(b(),g("span",$e,u(l(m))+" Video pills",1))]),a(w,{label:"VIDEO PILL",onClick:C[0]||(C[0]=U=>B.$router.push("/quiz-detail")),icon:"pi pi-plus",class:"mb-3"})]),a(Be)]),_:1})])}}});export{je as default};

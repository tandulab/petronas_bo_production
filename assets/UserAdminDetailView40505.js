import{r as d,q as H,af as J,u as K,c as b,n as M,b as u,l as Q,e as U,f as T,g as o,h as i,i as j,j as k,z as F,w as W,m as I,A as X}from"./usetoast.esm40505.js";import{a as y,s as S,h as r,e as h}from"./helpers40505.js";import{u as Y}from"./user40505.js";import{u as Z}from"./country40505.js";import{u as $}from"./useconfirm.esm40505.js";import{_ as ee}from"./_plugin-vue_export-helper40505.js";const se={setup(){const A=d({icon:"pi pi-home",to:"/users-admin"}),t=d(""),C=d([{label:""}]),e=d({}),D=d(),g=d(!1),w=$(),m=H(),n=J(),a=Y();Z();const _=K(),p=d(!1),c=b(()=>a.getCurrentUser),x=b(()=>a.userAdminRoles);b(()=>_.getUserCountryId);const l=b(()=>_.getSelectedCountry),v=b(()=>a.getResponseCredentials),V=async function(s){S(),a.fetchUserDetail(s).then(()=>{r(),L()}).catch(f=>{r(),h(n,f)})},R=async function(){e.value.parent&&(e.value.parent_id=e.value.parent.id);const s={user:e.value};a.updateUserAdmin(s).then(()=>{r(),V(c.value.id+""),y(n,{message:"User updated correctly.",title:""})}).catch(f=>{r(),h(n,f)})},N=async function(){const s={user:e.value};a.createUserAdmin(s).then(()=>{r(),V(c.value.id+""),y(n,{message:"User created correctly.",title:""})}).catch(f=>{r(),h(n,f)})},L=function(){var s;e.value=Object.assign({},c.value),e.value.country_id=(s=c.value.country)==null?void 0:s.id},q=function(){B(e.value.role)},z=function(){if(g.value=!0,q(),p.value){y(n,{message:"Check that you have completed the required fields.",title:"",error:!0});return}t.value!=""&&e.value.id?R():N(),g.value=!1,S()},B=function(s){if(g.value)return s==""||s==null?p.value=!0:p.value=!1,p.value},P=async function(){a.disableUserAdmin(e.value.id+"",e.value.enabled).then(()=>{r(),e.value.enabled?y(n,{message:"User successfully enabled.",title:""}):y(n,{message:"User successfully disabled.",title:""})}).catch(s=>{r(),h(n,s)})},O=s=>{w.require({group:"credentials",target:s.currentTarget,message:"Are you sure you want to send credentials?",icon:"pi pi-exclamation-triangle"})},G=async function(){S(),await a.sendCredentials(c.value.id+"").then(()=>{v.value&&v.value.sent?n.add({summary:"Email sent successfully",detail:"Temporary password: "+v.value.temp_password,closable:!0,severity:"success"}):v.value.sent||n.add({summary:"Email was not sent",detail:"Temporary password: "+v.value.temp_password,closable:!0,severity:"warn"}),E(),r()}).catch(s=>{r(),h(n,s)})},E=function(){var s=document.getElementsByClassName("p-confirm-dialog-reject")[0];s&&s.click()};return M(async()=>{t.value=m.params.id+"",t.value!=""&&t.value!="undefined"?(V(t.value),C.value[0]={label:"Edit user"}):(C.value[0]={label:"New user"},e.value.country_id=l.value.id)}),{home:A,items:C,tmp_user:e,userAdminRoles:x,filteredUsers:D,saveUser:z,validateField:B,disableUser:P,confirmSendCredentials:O,closePopup:E,sendCredentials:G}},components:{}};const te={class:"m-4"},le={class:"flex justify-content-between align-items-center mb-3"},oe={class:"flex align-items-center justify-content-between"},ne=o("h2",{class:"mb-2"},"USER DETAILS",-1),ae={class:"formgrid grid col-10 px-0"},re={class:"field col-6"},ie=o("label",{for:"cluster"},"Cluster*",-1),ce={key:0,class:"p-error"},de={class:"field col-6"},ue=o("label",{for:"name"},"Full name",-1),me={class:"field col-6"},pe=o("label",{for:"name"},"Email",-1),_e={class:"flex p-3 align-items-center"},ve={class:"pl-2"},fe={class:"flex align-items-center pb-3 justify-content-end"};function be(A,t,C,e,D,g){const w=u("Breadcrumb"),m=u("Button"),n=u("InputSwitch"),a=u("Dropdown"),_=u("InputText"),p=u("Card"),c=u("ConfirmPopup"),x=Q("tooltip");return U(),T("div",te,[o("div",le,[i(w,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"]),o("div",null,[e.tmp_user.id?(U(),j(m,{key:0,label:"Send credentials",onClick:t[0]||(t[0]=l=>e.confirmSendCredentials(l)),class:"p-button-outlined mr-3",icon:"pi pi-envelope"})):k("",!0),i(m,{label:"Save",onClick:e.saveUser},null,8,["onClick"])])]),i(p,null,{content:F(()=>[o("div",oe,[ne,e.tmp_user.id?W((U(),j(n,{key:0,modelValue:e.tmp_user.enabled,"onUpdate:modelValue":t[1]||(t[1]=l=>e.tmp_user.enabled=l),onChange:t[2]||(t[2]=l=>e.disableUser())},null,8,["modelValue"])),[[x,e.tmp_user.enabled?"Enabled":"Disabled",void 0,{top:!0}]]):k("",!0)]),o("div",ae,[o("div",re,[ie,i(a,{modelValue:e.tmp_user.role,"onUpdate:modelValue":t[3]||(t[3]=l=>e.tmp_user.role=l),options:e.userAdminRoles,optionLabel:"name",optionValue:"value",id:"cluster",class:I(["w-full",{"p-invalid":e.validateField(e.tmp_user.role)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_user.role)?(U(),T("small",ce,"Campo obbligatorio.")):k("",!0)]),o("div",de,[ue,i(_,{id:"name",type:"text",modelValue:e.tmp_user.full_name,"onUpdate:modelValue":t[4]||(t[4]=l=>e.tmp_user.full_name=l),class:"w-full"},null,8,["modelValue"])]),o("div",me,[pe,i(_,{id:"name",type:"text",modelValue:e.tmp_user.email,"onUpdate:modelValue":t[5]||(t[5]=l=>e.tmp_user.email=l),class:"w-full"},null,8,["modelValue"])])])]),_:1}),i(c,{group:"credentials",id:"credentials"},{message:F(l=>[o("div",_e,[o("i",{class:I(l.message.icon),style:{"font-size":"1.5rem"}},null,2),o("p",ve,X(l.message.message),1)]),o("div",fe,[i(m,{label:"Cancel",class:"mr-3 p-button-text text-500",onClick:e.closePopup},null,8,["onClick"]),i(m,{label:"Send",class:"mr-4",onClick:e.sendCredentials},null,8,["onClick"])])]),_:1})])}const xe=ee(se,[["render",be]]);export{xe as default};

import{A as ue}from"./AudienceCard40505.js";import{U as ve}from"./UploadImageCard40505.js";import{E as _e,G as fe}from"./GalleryImageCard40505.js";import{U as pe}from"./UploadAttachmentCard40505.js";import{r,u as ge,q as be,af as he,c as q,n as ye,a as Ce,b as d,e as c,f as _,g as l,h as i,j as v,i as $,z,w,m as T,A as ee}from"./usetoast.esm40505.js";import{u as ke}from"./events40505.js";import{u as xe}from"./country40505.js";import{a as S,s as H,h,e as L,f as Ee,g as Ve,d as Ie,j as te,u as Te,b as Ue,c as Ae}from"./helpers40505.js";import{b as De,a as M,c as R}from"./formatData40505.js";import{u as Fe}from"./useconfirm.esm40505.js";import{v as N}from"./runtime-dom.esm-bundler40505.js";import{_ as we}from"./_plugin-vue_export-helper40505.js";import"./group40505.js";import"./user40505.js";import"./attachment40505.js";import"./datetime40505.js";const Se={setup(){const Y=r({icon:"pi pi-home",to:"/events"}),o=r(""),U=r([{label:""}]),e=r({}),J=["draft","online","archived"],V=r(""),j=r(!0),k=r(!0),B=r(!0),y=r(),g=r(),P=r(),m=r(),f=r(),x=r(!1),E=r(!1),G=ge(),A=be(),u=he(),n=Fe(),I=ke(),ae=xe(),p=q(()=>I.getCurrentEvent),oe=q(()=>ae.allCountries),K=q(()=>G.getSelectedCountry),O=async function(t){H(),I.fetchEventsDetail(t).then(()=>{h(),le()}).catch(a=>{h(),L(u,a)})},le=function(){var t,a;if(e.value=Object.assign({},p.value),e.value.country_id=(t=e.value.country)==null?void 0:t.id,V.value=((a=e.value.country)==null?void 0:a.default_language_code)+"",e.value.date=M(p.value.date+""),e.value.bookable_from=M(p.value.bookable_from+""),e.value.bookable_to=M(p.value.bookable_to+""),Ee(y,e),Ve(g,e),m.value){const s=e.value.gallery_images_url;s&&s.length>0&&(m.value.tmp_gallery=s),m.value.folder_url=e.value.folder_url}if(f.value){const s=e.value.attachment_urls;s&&s.length>0&&(f.value.tmp_attachment=s)}Ie(p,e)},Q=function(){var D,Z;const t=new FormData,a=Object.assign({},e.value);e.value.date&&(a.date=R(e.value.date)),e.value.bookable_from&&(a.bookable_from=R(e.value.bookable_from)),e.value.bookable_to&&(a.bookable_to=R(e.value.bookable_to));const s=g.value.tmp_image,C=m.value.files;if(s&&s.image&&(a.image=s.image),s&&(a.video_url=(D=g.value.tmp_image)==null?void 0:D.video_url),C&&C.length>0&&C.length>0&&te(C,"event[gallery_images][]",t),m.value&&(a.folder_url=m.value.folder_url),f.value){const F=f.value.files;F&&F.length>0&&F.length>0&&te(F,"event[attachments][]",t)}return a.country_id=(Z=a.country)==null?void 0:Z.id,delete a.country,(o.value||a.id)&&Te(p,a),delete a.target_all,delete a.target_clusters,delete a.target_group_ids,Ue(t,a,"event"),Ae(y,t,"event"),t},ne=async function(){const t={id:e.value.id,formData:Q()};I.updateEvents(t).then(()=>{h(),O(e.value.id+""),S(u,{message:"Event updated correctly.",title:""}),m.value.files=[],m.value.fileUpload.files=[],f.value.files=[],f.value.fileUpload.files=[]}).catch(a=>{h(),L(u,a)})},se=async function(){const t={formData:Q()};I.createEvents(t).then(()=>{h(),O(p.value.id+""),S(u,{message:"Event created correctly.",title:""}),Ce.push({name:"event-detail",params:{id:p.value.id}})}).catch(a=>{h(),L(u,a)})},ie=function(){x.value=!0,re(),E.value?S(u,{message:"Check that you have completed the required fields.",title:"",error:!0}):(A.params.id!=""||e.value.id?ne():se(),x.value=!1,H())},re=function(){var t,a;e.value.translations&&((a=(t=e.value.country)==null?void 0:t.language_codes)==null||a.forEach(s=>{b(e.value.translations[s].title),b(e.value.translations[s].description),b(e.value.translations[s].short_description)})),b(e.value.status),b(e.value.date),b(e.value.bookable_from),b(e.value.bookable_to)},b=function(t){if(x.value)return t==""||t==null?E.value=!0:E.value=!1,E.value},W=function(){var t,a,s,C;V.value!=((t=e.value.country)==null?void 0:t.default_language_code)&&(V.value=((a=e.value.country)==null?void 0:a.default_language_code)+"",e.value.translations={},(C=(s=e.value.country)==null?void 0:s.language_codes)==null||C.forEach(D=>{e.value.translations[D]={title:null,description:null}}))},de=t=>{n.require({group:"push",target:t.currentTarget,message:"Are you sure you want to send the push notification?",icon:"pi pi-exclamation-triangle",acceptLabel:"Send",rejectLabel:"Cancel"})},ce=t=>{n.require({target:t.currentTarget,message:"",group:"notification-group",icon:"",acceptIcon:"",rejectIcon:""})},X=function(){var t=document.getElementsByClassName("p-confirm-dialog-reject")[0];t.click()},me=async function(){H(),await I.sendPush(e.value.id+"").then(()=>{S(u,{message:"Notification sent correctly.",title:"",error:!1}),X(),h()}).catch(t=>{h(),L(u,t)})};return ye(async()=>{o.value=A.params.id+"",o.value!=""&&o.value!="undefined"?(O(o.value),U.value[0]={label:"Edit events"}):(e.value.status="draft",U.value[0]={label:"Add events"},e.value.country=K.value,e.value.country_id=K.value.id,W())}),{home:Y,items:U,tmp_events:e,events_status:J,audienceCard:y,selectedLang:V,showCheckboxAll:j,showSelectClusters:k,showSelectGroups:B,submitForm:x,uploadImageCard:g,eventContentCard:P,galleryImageCard:m,uploadAttachmentCard:f,countries:oe,eventDetail:p,validateField:b,saveEvent:ie,setSelectedLang:W,confirmSendPush:de,closePopup:X,sendPush:me,showNotificationPopUp:ce,formatDataFromISO:De}},components:{AudienceCard:ue,UploadImageCard:ve,EventContentCard:_e,GalleryImageCard:fe,UploadAttachmentCard:pe}};const Le={class:"m-4"},Ne={class:"flex justify-content-between align-items-center mb-3"},je={class:"flex flex-row"},Be={class:"flex align-items-start justify-content-between"},Pe=l("h2",{class:"mb-2"},"EVENT DETAIL",-1),Ge={key:0,class:"field col-2 mb-0"},Oe={key:0,class:"p-error"},qe={class:"formgrid grid col-10 px-0 xs:col-12"},ze={key:0,class:"field col-6 xs:col-6 flex flex-column"},He=l("label",{for:"name"},"Location",-1),Me={key:0,class:"formgrid grid col-10 px-0 xs:col-12"},Re={class:"field col-3 xs:col-4"},Ye=l("label",{for:"name"},"Event date*",-1),Je={key:0,class:"p-error"},Ke={class:"field col-3 xs:col-4"},Qe=l("label",{for:"name"},"Bookable from*",-1),We={key:0,class:"p-error"},Xe={class:"field col-3 xs:col-4"},Ze=l("label",{for:"name"},"Bookable to*",-1),$e={key:0,class:"p-error"},et={key:1,class:"formgrid grid col-10 px-0 xs:col-12"},tt={class:"field col-3 flex flex-column"},at=l("label",{for:"title"},"Available seats",-1),ot={class:"field col-6 flex flex-column"},lt=l("label",{for:"title"},"Number of guests per participant (in addition to the guest)",-1),nt={class:"field col-3 mt-4 mb-0"},st={class:"field-checkbox"},it=l("label",{for:"gift"},"There is a free gift",-1),rt={class:"flex p-3 align-items-center"},dt={class:"pl-2"},ct={class:"flex align-items-center pb-3 justify-content-end"},mt={class:"col-12 mb-2 px-3"},ut=l("h2",{class:"mb-3"},"Last push notifications",-1);function vt(Y,o,U,e,J,V){const j=d("Breadcrumb"),k=d("Button"),B=d("Dropdown"),y=d("InputText"),g=d("Calendar"),P=d("Checkbox"),m=d("Card"),f=d("AudienceCard"),x=d("EventContentCard"),E=d("UploadImageCard"),G=d("GalleryImageCard"),A=d("UploadAttachmentCard"),u=d("ConfirmPopup");return c(),_("div",Le,[l("div",Ne,[i(j,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"]),l("div",je,[e.eventDetail.notification_counter?(c(),_("i",{key:0,class:"pi info-icon mr-1",onClick:o[0]||(o[0]=n=>e.showNotificationPopUp(n))})):v("",!0),e.tmp_events.id?(c(),$(k,{key:1,label:"Send push",onClick:o[1]||(o[1]=n=>e.confirmSendPush(n)),class:"mr-3 p-button-outlined",icon:"pi pi-envelope"})):v("",!0),i(k,{label:"Save",onClick:e.saveEvent},null,8,["onClick"])])]),i(m,null,{content:z(()=>[l("div",Be,[Pe,e.tmp_events.country?(c(),_("div",Ge,[i(B,{modelValue:e.tmp_events.status,"onUpdate:modelValue":o[2]||(o[2]=n=>e.tmp_events.status=n),options:e.events_status,class:T(["w-full capitalize dropdown-status",{"p-invalid":e.validateField(e.tmp_events.status)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_events.status)?(c(),_("small",Oe,"Campo obbligatorio.")):v("",!0)])):v("",!0)]),l("div",qe,[e.tmp_events.country?(c(),_("div",ze,[He,i(y,{id:"title",type:"text",modelValue:e.tmp_events.location,"onUpdate:modelValue":o[3]||(o[3]=n=>e.tmp_events.location=n)},null,8,["modelValue"])])):v("",!0)]),e.tmp_events.country?(c(),_("div",Me,[l("div",Re,[Ye,i(g,{inputId:"dateformat",modelValue:e.tmp_events.date,"onUpdate:modelValue":o[4]||(o[4]=n=>e.tmp_events.date=n),dateFormat:"dd/mm/yy",manualInput:!1,class:T({"p-invalid":e.validateField(e.tmp_events.date)}),placeholder:"gg/mm/aaaa"},null,8,["modelValue","class"]),e.validateField(e.tmp_events.date)?(c(),_("small",Je,"Campo obbligatorio.")):v("",!0)]),l("div",Ke,[Qe,i(g,{inputId:"dateformat",modelValue:e.tmp_events.bookable_from,"onUpdate:modelValue":o[5]||(o[5]=n=>e.tmp_events.bookable_from=n),dateFormat:"dd/mm/yy",manualInput:!1,class:T({"p-invalid":e.validateField(e.tmp_events.bookable_from)}),placeholder:"gg/mm/aaaa"},null,8,["modelValue","class"]),e.validateField(e.tmp_events.bookable_from)?(c(),_("small",We,"Campo obbligatorio.")):v("",!0)]),l("div",Xe,[Ze,i(g,{inputId:"dateformat",modelValue:e.tmp_events.bookable_to,"onUpdate:modelValue":o[6]||(o[6]=n=>e.tmp_events.bookable_to=n),dateFormat:"dd/mm/yy",manualInput:!1,class:T({"p-invalid":e.validateField(e.tmp_events.bookable_to)}),placeholder:"gg/mm/aaaa"},null,8,["modelValue","class"]),e.validateField(e.tmp_events.bookable_to)?(c(),_("small",$e,"Campo obbligatorio.")):v("",!0)])])):v("",!0),e.tmp_events.country?(c(),_("div",et,[l("div",tt,[at,i(y,{id:"title",type:"text",modelValue:e.tmp_events.seats,"onUpdate:modelValue":o[7]||(o[7]=n=>e.tmp_events.seats=n)},null,8,["modelValue"])]),l("div",ot,[lt,i(y,{id:"title",type:"text",modelValue:e.tmp_events.guests,"onUpdate:modelValue":o[8]||(o[8]=n=>e.tmp_events.guests=n)},null,8,["modelValue"])]),l("div",nt,[l("div",st,[i(P,{inputId:"gift",modelValue:e.tmp_events.gift,"onUpdate:modelValue":o[9]||(o[9]=n=>e.tmp_events.gift=n),binary:!0},null,8,["modelValue"]),it])])])):v("",!0)]),_:1}),w(i(f,{ref:"audienceCard"},null,512),[[N,e.tmp_events.country]]),e.tmp_events.country&&e.selectedLang?(c(),$(x,{key:0,selectedLang:e.selectedLang,submitForm:e.submitForm,tmp_events:e.tmp_events,ref:"eventContentCard",title:"EVENT CONTENT"},null,8,["selectedLang","submitForm","tmp_events"])):v("",!0),w(i(E,{title:"EVENT MEDIA",videoUrl:!0,ref:"uploadImageCard",class:"mt-3",dynamicClass:"col-5"},null,512),[[N,e.tmp_events.country]]),w(i(G,{title:"EVENT GALLERY",videoUrl:!0,ref:"galleryImageCard"},null,512),[[N,e.tmp_events.country&&e.tmp_events.id]]),w(i(A,{title:"EVENT ATTACHMENTS",videoUrl:!1,ref:"uploadAttachmentCard"},null,512),[[N,e.tmp_events.country&&e.tmp_events.id]]),i(u,{group:"push",id:"push"},{message:z(n=>[l("div",rt,[l("i",{class:T(n.message.icon),style:{"font-size":"1.5rem"}},null,2),l("p",dt,ee(n.message.message),1)]),l("div",ct,[i(k,{label:"Cancel",class:"mr-3 p-button-text text-500",onClick:e.closePopup},null,8,["onClick"]),i(k,{label:"Send",class:"mr-4",onClick:e.sendPush},null,8,["onClick"])])]),_:1}),i(u,{group:"notification-group",id:"notification-group"},{message:z(()=>[l("div",mt,[ut,l("p",null," Last push sent at: "+ee(e.formatDataFromISO(e.eventDetail.last_notification_at)),1)])]),_:1})])}const Dt=we(Se,[["render",vt]]);export{Dt as default};

import{u as pe}from"./user40505.js";import{D as me}from"./datetime40505.js";import{u as H}from"./useconfirm.esm40505.js";import{r as g,b as _,l as _e,e as l,f as r,g as s,A as w,w as Q,h as m,F as L,y as O,C as I,j as v,n as W,i as M,z as D,af as X,u as fe,q as he,c as F,a as ge,m as ve}from"./usetoast.esm40505.js";import{_ as q}from"./_plugin-vue_export-helper40505.js";import{l as ye,i as xe,s as Z,h as S,a as E,e as P,j as be,m as J,b as ke}from"./helpers40505.js";import{u as Ce}from"./insight40505.js";import{u as we}from"./product40505.js";import{U as Se}from"./UploadImageCard40505.js";import{u as Ue}from"./attachment40505.js";const Ie={props:{target:Object},setup(){const b=H(),t=g({});return{confirm:b,insight:t}}};const De={key:0,class:"insight border-round-lg m-2 border-300 border-solid border-1 p-3 h-full pt-2"},Ve={class:"flex align-items-center justify-content-between mb-2"},ze={class:"my-0"},Fe={key:0},Te={key:1},Be={class:"actions"},Re={key:0,class:"text-sm"},Ae={class:"truncate-products"},Ee={key:0},Pe={key:0},je={class:"uppercase"},Ne={key:1},Le=s("p",{class:"text-center"},[s("i",null,"Insight not configured")],-1),Oe=[Le];function Me(b,t,i,e,k,f){const y=_("Button"),h=_e("tooltip");return i.target?(l(),r("div",De,[s("div",Ve,[s("h2",ze,[i.target.quarter==0?(l(),r("span",Fe,"YEAR")):(l(),r("span",Te,"Q"+w(i.target.quarter),1))]),s("div",Be,[Q(m(y,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-2",icon:"pi pi-pencil",onClick:t[0]||(t[0]=c=>b.$emit("open",i.target))},null,512),[[h,"Edit",void 0,{top:!0}]]),Q(m(y,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-0",icon:"pi ranking-icon",onClick:t[1]||(t[1]=c=>b.$emit("ranking",i.target))},null,512),[[h,"Ranking",void 0,{top:!0}]])])]),i.target.products.length>0||i.target.all_products?(l(),r("div",Re,[s("div",Ae,[i.target.all_products?(l(),r("span",Ee," All products ")):(l(!0),r(L,{key:1},O(i.target.products,(c,a)=>(l(),r("span",{key:c.id,class:"mb-1 inline-block mr-1 text-sm"},[a!=0?(l(),r("span",Pe," / ")):v("",!0),I(" "+w(c.name),1)]))),128))]),s("p",null,[I(" Units: "),s("span",je,w(i.target.unit),1)])])):(l(),r("div",Ne,Oe))])):v("",!0)}const qe=q(Ie,[["render",Me]]),Ye={props:{title:String,tmp_insight:{}},setup(b,{emit:t}){return W(async()=>{}),{catchEvent:f=>{t("open",f)},catchEventRanking:f=>{t("ranking",f)},catchDetailRanking:f=>{t("detail",f)}}},components:{InsightCard:qe}},Je={class:"flex justify-content-between align-items-center"},Ge={class:"uppercase"},Ke={class:"grid col-12 mb-4"};function Qe(b,t,i,e,k,f){const y=_("InsightCard"),h=_("Card");return l(),M(h,{class:"mt-4"},{content:D(()=>[s("div",Je,[s("h2",Ge,w(i.title),1)]),s("div",Ke,[(l(!0),r(L,null,O(i.tmp_insight,c=>(l(),r("div",{key:c,class:"flex-1"},[m(y,{target:c,onOpen:t[0]||(t[0]=a=>e.catchEvent(a)),onRanking:t[1]||(t[1]=a=>e.catchEventRanking(a)),onDetail:t[2]||(t[2]=a=>e.catchDetailRanking(a))},null,8,["target"])]))),128))])]),_:1})}const He=q(Ye,[["render",Qe]]),We={props:{title:String,videoUrl:Boolean},setup(b,t){const i=g({}),e=Ue(),k=X(),f=g(),y=a=>{i.value.file_url={},i.value.file=a.files[0]},h=async()=>{const a=i.value.file_url.id;a?(Z(),await e.deleteAttachment(a).then(()=>{S(),E(k,{message:"File deleted correctly.",title:""}),c()}).catch(T=>{S(),P(k,T)})):c()},c=()=>{i.value={},f.value.files=[]};return t.expose({tmp_file:i,deleteFile:h}),{tmp_file:i,fileUpload:f,onSelectedFiles:y,deleteFile:h,formatSize:ye,getFileName:xe,deleteTmpFile:c}}};const Xe={class:"flex align-items-center justify-content-between"},Ze={class:"mb-4"},$e={class:"flex col-10"},et={class:"col-6 flex-column p-0"},tt={key:0,class:"card m-0 flex border-1 surface-border align-items-center justify-content-between pl-4 pr-3 py-3 w-full my-2"},ot={class:"flex align-items-center"},st=s("i",{class:"pi pi-file text-2xl"},null,-1),nt={key:0,class:"flex flex-column ml-2 file",style:{"font-size":"12px"}},lt={class:"mb-1"},it={key:1,class:"flex flex-column ml-2 file",style:{"font-size":"12px"}},at={class:"mb-1"},rt={key:0,class:"text-center"},dt=s("b",null,"Drag and drop file to here to upload.",-1),ct=s("p",{class:"text-xs"},"(Maximum size 2 MB)",-1),ut=[dt,ct];function pt(b,t,i,e,k,f){const y=_("Button"),h=_("FileUpload"),c=_("Card");return l(),M(c,{class:"mt-4"},{content:D(()=>[s("div",Xe,[s("h2",Ze,w(i.title),1)]),s("div",$e,[s("div",et,[m(h,{name:"file",url:"https://www.primefaces.org/upload.php",multiple:!1,accept:"application/pdf",maxFileSize:2e6,id:"logo",modelValue:e.tmp_file.file,"onUpdate:modelValue":t[1]||(t[1]=a=>e.tmp_file.file=a),customUpload:!0,onSelect:e.onSelectedFiles,onRemove:e.deleteTmpFile,fileLimit:1,ref:"fileUpload"},{content:D(()=>[e.tmp_file.file||e.tmp_file.file_url&&e.tmp_file.file_url.url?(l(),r("div",tt,[s("div",ot,[st,e.tmp_file.file&&e.tmp_file.file.name?(l(),r("div",nt,[s("div",lt,w(e.tmp_file.file.name),1),s("div",null,w(e.formatSize(e.tmp_file.file.size)),1)])):v("",!0),e.tmp_file.file_url&&e.tmp_file.file_url.url?(l(),r("div",it,[s("div",at,w(e.getFileName(e.tmp_file.file_url.url)),1)])):v("",!0)]),m(y,{icon:"pi pi-times",onClick:t[0]||(t[0]=a=>e.deleteFile()),class:"p-button p-component p-button-icon-only p-fileupload-file-remove p-button-text p-button-danger p-button-rounded"})])):v("",!0)]),empty:D(()=>[e.tmp_file.file_url?v("",!0):(l(),r("div",rt,ut))]),_:1},8,["modelValue","onSelect","onRemove"])])])]),_:1})}const mt=q(We,[["render",pt]]),_t={setup(){const b=g({icon:"pi pi-home",to:"/dashboard"}),t=g(),i=g([{label:"Dashboard"}]),e=g([]),k=g(),f=g({}),y=g([{name:"KG",value:"kg"},{name:"LT",value:"lt"}]),h=pe(),c=Ce(),a=X(),T=fe();H();const u=g({}),V=g(),z=g(),U=g(!1);he();const B=F(()=>h.userRolesItaly),Y=F(()=>c.getCurrentInsights),n=F(()=>T.getSelectedCountry),C=we(),j=F(()=>C.allProducts),G=F(()=>c.getNumTarget),$=F(()=>c.ranking_params),R=async function(){Z();const o=new Map;o.set("country_id",n.value.id),o.set("year",k.value),c.fetchAllInsights(o).then(()=>{S(),ee()}).catch(d=>{S(),P(a,d)})},ee=function(){f.value=Object.assign({},Y.value)},te=function(o){var d;(d=n.value.language_codes)==null||d.forEach(p=>{o.translations[p].description==null&&(o.translations[p].description={text:""}),o.translations[p].short_description==null&&(o.translations[p].short_description={text:""}),o.translations[p].prize==null&&(o.translations[p].prize={text:""})}),o.product_ids=[],o.all_products?o.product_ids=j.value.map(p=>p.id+""):o.products.forEach(p=>{o.product_ids.push(p.id)}),z.value&&o.prize_image_url&&(z.value.tmp_image.image_url=o.prize_image_url),V.value&&o.pdf_url&&(V.value.tmp_file.file_url=o.pdf_url)},oe=function(){var K;const o=new FormData,d={},p=z.value.tmp_image,A=V.value.tmp_file;p&&p.image&&(d.prize_image=p.image),A&&A.file&&(d.pdf=A.file),u.value.all_products?d.all_products=!0:be(u.value.product_ids,"insight[product_ids][]",o),d.unit=u.value.unit,d.translations={};for(const N in u.value.translations){const x=u.value.translations[N];x.description.id?J(x.description.text,x.description.id):o.append("insight[translations]["+N+"][description]",x.description.text),x.short_description.id?J(x.short_description.text,x.short_description.id):o.append("insight[translations]["+N+"][short_description]",x.short_description.text),x.prize.id?J(x.prize.text,x.prize.id):o.append("insight[translations]["+N+"][prize]",x.prize.text)}return d.translations={},ke(o,d,"insight"),u.value.all_products||o.append("insight[all_products]","false"),((K=u.value.product_ids)==null?void 0:K.length)==0&&o.append("insight[product_ids]","[]"),o},se=async function(){const o={id:u.value.id,formData:oe()};c.updateInsight(o).then(()=>{S(),R(),E(a,{message:"Insight updated correctly.",title:""}),U.value=!1}).catch(d=>{S(),P(a,d)})},ne=o=>{u.value=JSON.parse(JSON.stringify(o)),setTimeout(()=>{te(u.value)},500),U.value=!0},le=o=>{const d=new FormData;d.append("file",o.files[0]);const p={id:u.value.id,formData:d};c.importTarget(p).then(()=>{S(),R(),G.value?E(a,{message:G.value+" targets uploaded.",title:""}):E(a,{message:"0 teargets uploaded.",title:""})}).catch(A=>{S(),P(a,A)})},ie=o=>{u.value.all_products=o.checked,o.checked?u.value.product_ids=j.value.map(d=>d.id+""):u.value.product_ids=[]},ae=o=>{u.value.all_products=o.value.length===j.value.length},re=o=>{var d=JSON.parse(JSON.stringify(o)),p=d.cluster;p=="user"&&(p="workshop"),p=="dealer"&&(p="distributor"),ge.push({name:"ranking",params:{year:d.year,cluster:p,quarter:d.quarter}})},de=()=>{ce()},ce=async function(){const o={id:u.value.id};c.resetInsight(o).then(()=>{S(),E(a,{message:"Insight successfully reset.",title:""}),U.value=!1,R()}).catch(d=>{S(),P(a,d)})},ue=function(){u.value={},U.value=!1};return W(async()=>{let o=+me.now().toFormat("yyyy");e.value.push(o-1),e.value.push(o),e.value.push(+o+1),k.value=o,R()}),{date:t,selectedYear:k,years:e,items:i,home:b,tmp_insight:f,dialog_insight:u,uploadPdfCard:V,uploadImageCard:z,units:y,visible:U,userRolesItaly:B,products:j,selectedCountry:n,rankingParamsNavigation:$,fetchInsights:R,showDialog:ne,onUpload:le,onSelectAllChange:ie,onChange:ae,showRanking:re,updateInsight:se,closeDialog:ue,resetForm:de}},components:{InsightByAudienceCard:He,UploadImageCard:Se,UploadPdfCard:mt}};const ft={class:"flex justify-content-between align-items-center mb-3"},ht=s("div",{class:"flex justify-content-between align-items-center"},[s("h1",{class:"uppercase"},"Dashboard")],-1),gt={class:"col-2"},vt={key:0,class:"flex flex-column col-12"},yt={class:"field col-6 mb-0"},xt=s("label",{for:"products"},"Products",-1),bt={class:"flex flex-wrap"},kt={key:0,class:"field col-12 flex flex-column"},Ct={class:"uppercase"},wt=s("i",{style:{"font-size":"12px"}},"ES: Acquista entro il 30 Giugno 200 l di prodotti Syntium o Selenia, in omaggio 1 kit Petronas",-1),St={key:1,class:"field col-12 flex flex-column"},Ut={class:"uppercase"},It={key:2,class:"field col-12 flex flex-column"},Dt={class:"uppercase"},Vt={class:"field col-12 flex my-0 py-0"},zt={class:"field col-6 upload-file pl-0 my-0 pt-0"},Ft={class:"field col-6 upload-file my-0 pt-0"},Tt={class:"col-12 flex align-items-center justify-content-between my-0"},Bt={class:"col-6 flex flex-column field my-0"},Rt=s("label",{for:"unit"},"Unit of measurement",-1),At={class:"col-6 flex align-items-center justify-content-end"},Et={key:0,href:"https://petronas-adv-test.s3-eu-west-1.amazonaws.com/template_sellout_targets.xlsx",class:"p-button mr-4 p-button-outlined",icon:"pi pi-download"},Pt=s("i",{class:"pi pi-download mr-2"},null,-1),jt={key:1,href:"https://petronas-adv.s3-eu-west-1.amazonaws.com/template_sellout_target.xlsx",class:"p-button mr-4 p-button-outlined",icon:"pi pi-download"},Nt=s("i",{class:"pi pi-download mr-2"},null,-1),Lt={class:"flex justify-content-end"};function Ot(b,t,i,e,k,f){const y=_("Breadcrumb"),h=_("Dropdown"),c=_("Card"),a=_("InsightByAudienceCard"),T=_("MultiSelect"),u=_("Textarea"),V=_("UploadImageCard"),z=_("UploadPdfCard"),U=_("FileUpload"),B=_("Button"),Y=_("Dialog");return l(),r("div",null,[s("div",ft,[m(y,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"])]),m(c,null,{content:D(()=>[ht,s("div",gt,[m(h,{modelValue:e.selectedYear,"onUpdate:modelValue":t[0]||(t[0]=n=>e.selectedYear=n),options:e.years,placeholder:"Select a year",class:"w-full md:w-14rem",onChange:t[1]||(t[1]=n=>e.fetchInsights())},null,8,["modelValue","options"])])]),_:1}),(l(!0),r(L,null,O(e.userRolesItaly,n=>(l(),r("div",{key:n.value},[n.value=="dealer"&&e.selectedCountry.name=="Belgium"||n.value=="agent"&&e.selectedCountry.name=="Italy"||e.selectedCountry.name!="Belgium"?(l(),M(a,{key:0,title:n.name,tmp_insight:e.tmp_insight[n.value],onOpen:t[2]||(t[2]=C=>e.showDialog(C)),onRanking:t[3]||(t[3]=C=>e.showRanking(C)),class:ve(n.value)},null,8,["title","tmp_insight","class"])):v("",!0)]))),128)),m(Y,{header:"Insight",style:{width:"80vw"},class:"insight",visible:e.visible,"onUpdate:visible":t[11]||(t[11]=n=>e.visible=n),modal:""},{footer:D(()=>[s("div",Lt,[e.dialog_insight.id?(l(),M(B,{key:0,label:"Reset",class:"mr-3 p-button-text",onClick:t[8]||(t[8]=n=>e.resetForm())})):v("",!0),m(B,{label:"Cancel",class:"mr-3 p-button-outlined",onClick:t[9]||(t[9]=n=>e.closeDialog())}),m(B,{label:"Save",onClick:t[10]||(t[10]=n=>e.updateInsight())})])]),default:D(()=>[e.dialog_insight&&e.dialog_insight.translations?(l(),r("div",vt,[s("div",yt,[xt,m(T,{modelValue:e.dialog_insight.product_ids,"onUpdate:modelValue":t[4]||(t[4]=n=>e.dialog_insight.product_ids=n),options:e.products,optionLabel:"name",optionValue:"id",class:"w-full capitalize",selectAll:e.dialog_insight.all_products,maxSelectedLabels:10,display:"chip",onSelectallChange:t[5]||(t[5]=n=>e.onSelectAllChange(n)),onChange:t[6]||(t[6]=n=>e.onChange(n))},null,8,["modelValue","options","selectAll"])]),s("div",bt,[(l(!0),r(L,null,O(e.selectedCountry.language_codes,n=>(l(),r("div",{key:n,class:"col-6 p-0"},[e.dialog_insight.translations[n].short_description?(l(),r("div",kt,[s("label",null,[I("Short Description "),s("span",Ct,"("+w(n)+")",1)]),wt,m(u,{modelValue:e.dialog_insight.translations[n].short_description.text,"onUpdate:modelValue":C=>e.dialog_insight.translations[n].short_description.text=C,maxlength:"450"},null,8,["modelValue","onUpdate:modelValue"])])):v("",!0),e.dialog_insight.translations[n].description?(l(),r("div",St,[s("label",null,[I("Description "),s("span",Ut,"("+w(n)+")",1)]),m(u,{modelValue:e.dialog_insight.translations[n].description.text,"onUpdate:modelValue":C=>e.dialog_insight.translations[n].description.text=C,style:{height:"100px"}},null,8,["modelValue","onUpdate:modelValue"])])):v("",!0),e.dialog_insight.translations[n].prize?(l(),r("div",It,[s("label",null,[I("Prize Description "),s("span",Dt,"("+w(n)+")",1)]),m(u,{modelValue:e.dialog_insight.translations[n].prize.text,"onUpdate:modelValue":C=>e.dialog_insight.translations[n].prize.text=C,style:{height:"100px"}},null,8,["modelValue","onUpdate:modelValue"])])):v("",!0)]))),128))]),s("div",Vt,[s("div",zt,[m(V,{title:"Prize image",ref:"uploadImageCard",videoUrl:!1},null,512)]),s("div",Ft,[m(z,{title:"Folder",ref:"uploadPdfCard",videoUrl:!1},null,512)])]),s("div",Tt,[s("div",Bt,[Rt,m(h,{modelValue:e.dialog_insight.unit,"onUpdate:modelValue":t[7]||(t[7]=n=>e.dialog_insight.unit=n),options:e.units,optionLabel:"name",optionValue:"value",placeholder:"Select a unit",class:"w-full md:w-14rem",id:"unit"},null,8,["modelValue","options"])]),s("div",At,[e.selectedCountry.country_code=="IT"||e.dialog_insight.cluster!="user"?(l(),r("a",Et,[Pt,I(" TEMPLATE ")])):v("",!0),e.selectedCountry.country_code!="IT"&&e.dialog_insight.cluster=="user"?(l(),r("a",jt,[Nt,I(" TEMPLATE ")])):v("",!0),m(U,{mode:"basic",name:"demo[]",url:"./upload.php",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",maxFileSize:1e6,onUploader:e.onUpload,customUpload:"",auto:!0,chooseLabel:"Import Target"},null,8,["onUploader"])])])])):v("",!0)]),_:1},8,["visible"])])}const Zt=q(_t,[["render",Ot]]);export{Zt as default};

import{o as K,u as O,c as j,af as G,r as c,b as h,l as Q,e as _,f,h as d,z as C,j as E,C as V,g as x,A as k,w as I,n as R,F as W,y as X,m as Y}from"./usetoast.esm40505.js";import{u as H}from"./useconfirm.esm40505.js";import{u as U}from"./category40505.js";import{a as Z}from"./formatData40505.js";import{e as A,a as N,s as P,h as L}from"./helpers40505.js";import{_ as J}from"./_plugin-vue_export-helper40505.js";import"./datetime40505.js";const $={setup(F,i){K(()=>{var s;T(),l.value=[],(s=m.value.language_codes)==null||s.forEach(t=>{l.value.push(t)})});const r=U(),e=H(),D=O(),m=j(()=>D.getSelectedCountry),p=j(()=>r.allCategories),o=G(),u=c(!0),y=c([{label:"My Filter",value:"myfilter"}]),v=c(!1);c({}),c();const a=c(!1),l=c();function T(){u.value=!0,setTimeout(()=>{B()},Math.random()*1e3+250)}const B=async function(){const s=new Map;s.set("country_id",m.value.id),await r.fetchAllCategories(s).then(()=>{u.value=!1}).catch(t=>{u.value=!1,A(o,t)})},b=(s,t)=>{t.users_counter>0?e.require({target:s.currentTarget,message:"The category cannot be deleted because there are associated users.",icon:"pi pi-exclamation-triangle",rejectClass:"hidden",acceptClass:"hidden"}):e.require({target:s.currentTarget,message:"Are you sure you want to remove this category?",icon:"pi pi-exclamation-triangle",accept:()=>{S(t.id)}})},S=async function(s){await r.deleteCategory(s).then(()=>{N(o,{message:"Category deleted correctly.",title:""}),T()}).catch(t=>{A(o,t)})},q=function(s){return v.value?s==""||s==null:!1},z=s=>{i.emit("editCategory",s)};return i.expose({loadLazyData:T}),{categories:p,loading:u,loadLazyData:T,matchModes:y,languages:l,toggleEdit:z,confirmDeleteCategory:b,formatDataFromSql:Z,isVisible:a,validateField:q}}};const ee={key:0,class:"col-5 col-xs-12 col-md-12"},te={class:"uppercase"},ae={key:0},oe={class:"uppercase"},se={key:0};function ne(F,i,r,e,D,m){const p=h("Column"),o=h("Button"),u=h("DataTable"),y=h("ConfirmPopup"),v=Q("tooltip");return e.languages?(_(),f("div",ee,[d(u,{value:e.categories,lazy:!0,loading:e.loading},{empty:C(()=>[V(" No categories found. ")]),default:C(()=>[d(p,{field:"translations"},{header:C(()=>[V(" Name "),x("span",te," ("+k(e.languages[0])+")",1)]),body:C(({data:a})=>[a.translations[e.languages[0]]&&a.translations[e.languages[0]].name?(_(),f("span",ae,k(a.translations[e.languages[0]].name.text),1)):E("",!0)]),_:1}),d(p,{field:"translations"},{header:C(()=>[V(" Name "),x("span",oe," ("+k(e.languages[1])+") ",1)]),body:C(({data:a})=>[a.translations[e.languages[1]]&&a.translations[e.languages[1]].name?(_(),f("span",se,k(a.translations[e.languages[1]].name.text),1)):E("",!0)]),_:1}),d(p,{header:"",style:{width:"9rem"}},{body:C(({data:a})=>[I(d(o,{type:"button",onClick:l=>e.toggleEdit(a),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil"},null,8,["onClick"]),[[v,"Edit",void 0,{top:!0}]]),I(d(o,{type:"button",onClick:l=>e.confirmDeleteCategory(l,a),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-trash",disabled:!a.can_delete},null,8,["onClick","disabled"]),[[v,"Delete",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","loading"]),d(y)])):E("",!0)}const le=J($,[["render",ne]]),re={setup(){const F=U(),i=H(),r=c({}),e=c({}),D=O(),m=G(),p=U(),o=c(!1),u=c(!1),y=c(),v=c(),a=j(()=>F.getTotalCategories),l=j(()=>D.getSelectedCountry),T=t=>{t?B(t):i.require({group:"templating",header:"New Category",accept:()=>{if(o.value=!0,S(e.value[v.value]))o.value=!1,b();else{o.value=!1,q();return}},reject:()=>{o.value=!1,u.value=!1,b()},acceptLabel:"Save",rejectLabel:"Cancel"})},B=function(t){var g;(g=l.value.language_codes)==null||g.forEach(n=>{t.translations[n]&&t.translations[n].name.text&&(e.value[n]=t.translations[n].name.text+"")}),i.require({group:"templating",header:"Edit Category",accept:()=>{var w;o.value=!0;let n=!1;if((w=l.value.language_codes)==null||w.forEach(M=>{S(e.value[M])&&(n=!0)}),n)N(m,{message:"Compila i campi obbligatori",error:!0}),o.value=!1,b();else{o.value=!1,z(t.translations);return}},reject:()=>{o.value=!1,u.value=!1,b()},acceptLabel:"Save",rejectLabel:"Cancel"})},b=function(){var t;(t=l.value.language_codes)==null||t.forEach(g=>{e.value[g]=""})},S=function(t){return o.value?t==""||t==null:!1},q=async function(){var g;P(),r.value.translations={};for(const n in e.value)r.value.translations[n]={name:e.value[n]};r.value.country_id=(g=r.value.country)==null?void 0:g.id;const t={news_category:r.value};p.createCategory(t).then(()=>{L(),N(m,{message:"Category created correctly.",title:""}),y.value.loadLazyData(),o.value=!1,b()}).catch(n=>{L(),A(m,n),o.value=!1})},z=async function(t){P();for(const[g,n]of Object.entries(t)){const w=n.name.id,M=e.value[g];s(w,M)}},s=function(t,g){const n={id:t,text:g};p.editCategory(n).then(()=>{L(),N(m,{message:"Category edited correctly",title:""}),y.value.loadLazyData(),o.value=!1,b()}).catch(w=>{L(),A(m,w),o.value=!1})};return R(async()=>{r.value.country=l.value,v.value=l.value.default_language_code}),{totalCategory:a,confirm:i,tmp_category:r,labels:e,categoriesTable:y,showTemplate:T,validateField:S,isVisible:u}},components:{CategoriesTable:le}},ce={class:"flex justify-content-between align-items-center"},ie={class:"uppercase"},ue={key:0},de={key:1},ge={key:0,class:"formgrid grid col-12"},me={class:"field col-12 flex p-0 flex-column"},pe={for:"name"},_e={class:"uppercase"},fe={key:0,class:"p-error"};function ye(F,i,r,e,D,m){const p=h("Button"),o=h("CategoriesTable"),u=h("InputText"),y=h("ConfirmDialog"),v=h("Card");return _(),f("div",null,[d(v,null,{content:C(()=>[x("div",ce,[x("h1",ie,[e.totalCategory==1?(_(),f("span",ue," 1 Category")):(_(),f("span",de,k(e.totalCategory)+" Categories",1))]),d(p,{label:"category",onClick:i[0]||(i[0]=a=>e.showTemplate(null)),icon:"pi pi-plus",class:"mb-3"})]),d(o,{ref:"categoriesTable",onEditCategory:i[1]||(i[1]=a=>e.showTemplate(a))},null,512),d(y,{group:"templating",style:{width:"20vw"}},{message:C(()=>[e.tmp_category.country?(_(),f("div",ge,[x("div",me,[(_(!0),f(W,null,X(e.tmp_category.country.language_codes,a=>(_(),f("div",{key:a,class:"col-12 mb-4"},[x("label",pe,[V("Name "),x("span",_e,"("+k(a)+")",1)]),d(u,{id:"name",type:"text",modelValue:e.labels[a],"onUpdate:modelValue":l=>e.labels[a]=l,class:Y(["w-full",{"p-invalid":e.validateField(e.tmp_category.name)}]),require:""},null,8,["modelValue","onUpdate:modelValue","class"]),e.validateField(e.tmp_category.name)?(_(),f("small",fe,"Campo obbligatorio.")):E("",!0)]))),128))])])):E("",!0)]),_:1})]),_:1})])}const ke=J(re,[["render",ye]]);export{ke as default};

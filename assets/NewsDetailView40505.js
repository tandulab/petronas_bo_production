import{r as s,af as le,b as d,l as ye,e as u,i as H,z,g as l,A as J,h as n,f as g,w as A,j as h,q as Ce,u as be,c as j,n as Ue,a as xe,m as R}from"./usetoast.esm40505.js";import{s as W,h as w,a as B,e as N,j as ae,u as Ve,b as Se,c as Ie,f as ke,g as De,k as Fe,d as Ne}from"./helpers40505.js";import{u as Ae}from"./user40505.js";import{u as Te}from"./news40505.js";import{u as Ee}from"./category40505.js";import{u as Le}from"./group40505.js";import{A as Pe}from"./AudienceCard40505.js";import{U as je}from"./UploadImageCard40505.js";import{E as Be,G as Ge}from"./GalleryImageCard40505.js";import{u as Oe}from"./attachment40505.js";import{_ as se}from"./_plugin-vue_export-helper40505.js";import{b as Re,c as qe,a as ze}from"./formatData40505.js";import{u as We}from"./useconfirm.esm40505.js";import{U as Ye}from"./UploadAttachmentCard40505.js";import{v as q}from"./runtime-dom.esm-bundler40505.js";import"./datetime40505.js";const Me={props:{title:String,videoUrl:Boolean},setup(T,a){const m=s({}),e=Oe(),S=le(),E=_=>{m.value.video_image_url={},m.value.video_image=_.files[0]},v=async _=>{_&&(W(),await e.deleteAttachment(_).then(()=>{w(),B(S,{message:"File deleted correctly.",title:""}),c()}).catch(f=>{w(),N(S,f)}))},c=()=>{m.value.video_image_url=null,m.value.video_image=null};return a.expose({tmp_video:m,deleteImage:v}),{tmp_video:m,deleteTmpImage:c,deleteImage:v,onUploadFile:E}}};const He={class:"flex align-items-center justify-content-between"},Je={class:"mb-4"},Ke={class:"flex"},Qe={class:"ml-0 col-8 pt-0"},Xe={class:"field"},Ze=l("label",{for:"video_url"},"Video Url (YouTube, Vimeo)",-1),$e={class:"col-12 pl-0"},et={key:0,class:"flex align-items-top mt-3"},tt=["src"],ot={key:1,class:"mt-2"},at={key:0,class:"flex align-items-center"},lt={class:"flex align-items-top mt-3"},st=["src"];function nt(T,a,m,e,S,E){const v=d("InputText"),c=d("FileUpload"),_=d("Card"),f=ye("tooltip");return u(),H(_,{class:"h-full"},{content:z(()=>{var I,k,D,C;return[l("div",He,[l("h2",Je,J(m.title),1)]),l("div",Ke,[l("div",Qe,[l("div",Xe,[Ze,n(v,{type:"text",modelValue:e.tmp_video.video_url,"onUpdate:modelValue":a[0]||(a[0]=p=>e.tmp_video.video_url=p),class:"w-full"},null,8,["modelValue"])]),l("div",$e,[n(c,{mode:"basic",name:"demo",accept:"image/*",customUpload:!0,onUploader:a[1]||(a[1]=p=>T.$emit("onUploadImgVideoPreview",p)),maxFileSize:1e6,auto:!0,chooseLabel:"Upload video image",class:"p-button-outlined",modelValue:e.tmp_video.video_image,"onUpdate:modelValue":a[2]||(a[2]=p=>e.tmp_video.video_image=p),onSelect:e.onUploadFile},null,8,["modelValue","onSelect"]),e.tmp_video.video_image_url&&e.tmp_video.video_image_url.url?(u(),g("div",et,[l("img",{role:"presentation",class:"p-fileupload-file-thumbnail h-4rem w-7rem",src:e.tmp_video.video_image_url.url,style:{border:"1px solid rgb(0 0 0 / 6%)"}},null,8,tt),A(l("i",{class:"pi pi-times p-button-icon text-red-600 cursor-pointer font-semibold icon-delete",onClick:a[3]||(a[3]=p=>e.deleteImage(e.tmp_video.video_image_url.id))},null,512),[[f,"Delete",void 0,{top:!0}]])])):(u(),g("div",ot,[(k=(I=e.tmp_video)==null?void 0:I.video_image)!=null&&k.objectURL?(u(),g("div",at,[l("div",lt,[l("img",{src:(C=(D=e.tmp_video)==null?void 0:D.video_image)==null?void 0:C.objectURL,class:"p-fileupload-file-thumbnail h-4rem w-7rem tmp_img"},null,8,st),A(l("i",{class:"pi pi-times p-button-icon text-red-600 cursor-pointer font-semibold icon-delete tmp-icon-delete",onClick:a[4]||(a[4]=p=>e.deleteTmpImage())},null,512),[[f,"Delete",void 0,{top:!0}]])])])):h("",!0)]))])])])]}),_:1})}const it=se(Me,[["render",nt]]),rt={setup(){const T=s({icon:"pi pi-home",to:"/news"}),a=s(""),m=s([{label:""}]),e=s({}),S=["draft","online","archived"],E=s(),v=s(!1),c=s(!1),_=s(),f=s(""),I=s(!0),k=s(!0),D=s(!0),C=s(),p=s(),b=s(),U=s(),F=s(),i=Ce(),y=le(),L=Te(),K=Ee(),ne=Le(),ie=Ae(),re=be(),Q=We(),x=j(()=>L.getCurrentNews),P=j(()=>K.allCategories),de=j(()=>ie.userRoles),ce=j(()=>ne.allGroups),X=j(()=>re.getSelectedCountry),Y=async function(o){W(),L.fetchNewsDetail(o).then(()=>{w(),_e()}).catch(t=>{w(),N(y,t)})},Z=function(){var oe;const o=new FormData,t=Object.assign({},e.value);e.value.published_at&&(t.published_at=qe(e.value.published_at));const r=p.value.tmp_image;r&&r.image&&(t.image=r.image);const V=F.value.tmp_video;V&&V.video_image&&(t.video_image=V.video_image),V&&(t.video_url=V.video_url);const G=b.value.files;G&&G.length>0&&G.length>0&&ae(G,"news[gallery_images][]",o);const O=U.value.files;return O&&O.length>0&&O.length>0&&ae(O,"news[gallery_pdfs][]",o),t.country_id=(oe=t.country)==null?void 0:oe.id,delete t.country,(a.value||t.id)&&Ve(x,t),delete t.target_all,delete t.target_clusters,delete t.target_group_ids,Se(o,t,"news"),Ie(C,o,"news"),o},ue=async function(){const o={id:e.value.id,formData:Z()};L.updateNews(o).then(()=>{w(),Y(e.value.id+""),B(y,{message:"News updated correctly.",title:""}),b.value.files=[],b.value.fileUpload.files=[],U.value.files=[],U.value.fileUpload.files=[]}).catch(t=>{w(),N(y,t)})},me=async function(){const o={formData:Z()};L.createNews(o).then(()=>{w(),Y(x.value.id+""),B(y,{message:"News created correctly.",title:""}),xe.push({name:"news-detail",params:{id:x.value.id}})}).catch(t=>{w(),N(y,t)})},_e=function(){var o,t;if(e.value=Object.assign({},x.value),e.value.country_id=(o=x.value.country)==null?void 0:o.id,f.value=((t=e.value.country)==null?void 0:t.default_language_code)+"",e.value.published_at=ze(x.value.published_at+""),ke(C,e),De(p,e),Fe(F,e),Ne(x,e),b.value){const r=e.value.gallery_images_url;r&&r.length>0&&(b.value.tmp_gallery=r)}if(U.value){const r=e.value.gallery_pdfs_url;r&&r.length>0&&(U.value.tmp_attachment=r)}e.value.news_category_id=e.value.news_category.id,ee(),delete e.value.news_category},pe=function(){M(e.value.published_at),M(e.value.news_category_id)},ve=function(){if(v.value=!0,pe(),c.value){B(y,{message:"Check that you have completed the required fields.",title:"",error:!0});return}a.value!=""||e.value.id?ue():me(),v.value=!1,W()},M=function(o){if(v.value)return o==""||o==null?c.value=!0:c.value=!1,c.value},$=function(o){_.value=[],o.value.forEach(t=>{if(t.country&&t.country.default_language_code){const r={id:t.id,value:t.translations[t.country.default_language_code].name.text};_.value.push(r)}})},ee=async function(){if(P.value&&P.value.length>0){$(P);return}const o=new Map;o.set("country_id",e.value.country.id),await K.fetchAllCategories(o).then(()=>{var t;$(P),f.value=((t=e.value.country)==null?void 0:t.default_language_code)+""}).catch(t=>{N(y,t)})},fe=o=>{Q.require({group:"push",target:o.currentTarget,message:"Are you sure you want to send the push notification?",icon:"pi pi-exclamation-triangle"})},ge=o=>{Q.require({target:o.currentTarget,message:"",group:"notification-group",icon:"",acceptIcon:"",rejectIcon:""})},he=async function(){W(),await L.sendPush(e.value.id+"").then(()=>{B(y,{message:"Notification sent correctly.",title:"",error:!1}),te(),w()}).catch(o=>{w(),N(y,o)})},te=function(){var o=document.getElementsByClassName("p-confirm-dialog-reject")[0];o.click()},we=function(o){e.value.video_image=o.files[0]};return Ue(async()=>{var o,t,r;a.value=i.params.id+"",a.value!=""&&a.value!="undefined"?(Y(a.value),m.value[0]={label:"Edit news"}):(e.value.status="draft",m.value[0]={label:"Add news"},e.value.country_id=X.value.id,e.value.country=X.value,f.value=((o=e.value.country)==null?void 0:o.default_language_code)+"",ee(),e.value.translations||(e.value.translations={},(r=(t=e.value.country)==null?void 0:t.language_codes)==null||r.forEach(V=>{e.value.translations[V]={title:null,short_description:null,description:null}})))}),{home:T,items:m,tmp_news:e,filteredUsers:E,filteredCategories:_,selectedLang:f,showCheckboxAll:I,showSelectClusters:k,showSelectGroups:D,userRoles:de,allGroups:ce,news_status:S,audienceCard:C,uploadImageCard:p,submitForm:v,categories:P,galleryImageCard:b,uploadAttachmentCard:U,uploadVideoCard:F,newsDetail:x,saveNews:ve,validateField:M,confirmSendPush:fe,closePopup:te,sendPush:he,onUploadImgVideoPreview:we,showNotificationPopUp:ge,formatDataFromISO:Re}},components:{AudienceCard:Pe,UploadImageCard:je,EventContentCard:Be,GalleryImageCard:Ge,UploadAttachmentCard:Ye,UploadVideoCard:it}};const dt={class:"m-4"},ct={class:"flex justify-content-between align-items-center mb-3"},ut={class:"flex flex-row"},mt={class:"flex align-items-center justify-content-between"},_t=l("h2",{class:"mb-2"},"NEWS DETAIL",-1),pt={key:0,class:"field col-2 mb-0"},vt={key:0,class:"p-error"},ft={class:"formgrid grid col-10 px-0 xs:col-12"},gt={key:0,class:"field col-4 xs:col-6"},ht=l("label",{for:"shipping_country"},"Category*",-1),wt={key:0,class:"p-error"},yt={key:1,class:"field col-4 xs:col-6"},Ct=l("label",{for:"name"},"Published at*",-1),bt={key:0,class:"p-error"},Ut={class:"flex jusfity-content-end mt-3"},xt={class:"col-6 flex-1 pl-0"},Vt={class:"col-6 flex-1 pr-0"},St={class:"flex p-3 align-items-center"},It={class:"pl-2"},kt={class:"flex align-items-center pb-3 justify-content-end"},Dt={class:"col-12 mb-2 px-3"},Ft=l("h2",{class:"mb-3"},"Last push notifications",-1);function Nt(T,a,m,e,S,E){const v=d("Breadcrumb"),c=d("Button"),_=d("Dropdown"),f=d("Calendar"),I=d("Card"),k=d("AudienceCard"),D=d("EventContentCard"),C=d("UploadImageCard"),p=d("UploadVideoCard"),b=d("GalleryImageCard"),U=d("UploadAttachmentCard"),F=d("ConfirmPopup");return u(),g("div",dt,[l("div",ct,[n(v,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"]),l("div",ut,[e.newsDetail.notification_counter?(u(),g("i",{key:0,class:"pi info-icon mr-1",onClick:a[0]||(a[0]=i=>e.showNotificationPopUp(i))})):h("",!0),e.tmp_news.id?(u(),H(c,{key:1,label:"Send push",onClick:a[1]||(a[1]=i=>e.confirmSendPush(i)),class:"mr-3 p-button-outlined",icon:"pi pi-envelope"})):h("",!0),n(c,{label:"Save",onClick:e.saveNews},null,8,["onClick"])])]),n(I,null,{content:z(()=>[l("div",mt,[_t,e.tmp_news.country?(u(),g("div",pt,[n(_,{modelValue:e.tmp_news.status,"onUpdate:modelValue":a[2]||(a[2]=i=>e.tmp_news.status=i),options:e.news_status,class:R(["w-full capitalize dropdown-status",{"p-invalid":e.validateField(e.tmp_news.status)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_news.status)?(u(),g("small",vt,"Campo obbligatorio.")):h("",!0)])):h("",!0)]),l("div",ft,[e.tmp_news.country?(u(),g("div",gt,[ht,n(_,{modelValue:e.tmp_news.news_category_id,"onUpdate:modelValue":a[3]||(a[3]=i=>e.tmp_news.news_category_id=i),options:e.filteredCategories,optionLabel:"value",optionValue:"id",class:R(["w-full",{"p-invalid":e.validateField(e.tmp_news.news_category_id)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_news.news_category_id)?(u(),g("small",wt,"Campo obbligatorio.")):h("",!0)])):h("",!0),e.tmp_news.country?(u(),g("div",yt,[Ct,n(f,{inputId:"dateformat",modelValue:e.tmp_news.published_at,"onUpdate:modelValue":a[4]||(a[4]=i=>e.tmp_news.published_at=i),dateFormat:"dd/mm/yy",manualInput:!1,class:R({"p-invalid":e.validateField(e.tmp_news.published_at)}),placeholder:"gg/mm/aaaa"},null,8,["modelValue","class"]),e.validateField(e.tmp_news.published_at)?(u(),g("small",bt,"Campo obbligatorio.")):h("",!0)])):h("",!0)])]),_:1}),A(n(k,{ref:"audienceCard"},null,512),[[q,e.tmp_news.country]]),e.tmp_news.country&&e.selectedLang?(u(),H(D,{key:0,selectedLang:e.selectedLang,submitForm:e.submitForm,tmp_events:e.tmp_news,title:"NEWS CONTENT"},null,8,["selectedLang","submitForm","tmp_events"])):h("",!0),l("div",Ut,[l("div",xt,[A(n(C,{title:"NEWS MEDIA",videoUrl:!1,ref:"uploadImageCard",dynamicClass:"col-12"},null,512),[[q,e.tmp_news.country]])]),l("div",Vt,[A(n(p,{title:"NEWS VIDEO",videoUrl:!1,ref:"uploadVideoCard",onOnUploadImgVideoPreview:a[5]||(a[5]=i=>e.onUploadImgVideoPreview(i))},null,512),[[q,e.tmp_news.country]])])]),A(n(b,{title:"NEWS GALLERY",videoUrl:!1,ref:"galleryImageCard"},null,512),[[q,e.tmp_news.country&&e.tmp_news.id]]),n(U,{title:"PDF GALLERY",videoUrl:!0,ref:"uploadAttachmentCard",accept:"application/pdf"},null,512),n(F,{group:"push",id:"push"},{message:z(i=>[l("div",St,[l("i",{class:R(i.message.icon),style:{"font-size":"1.5rem"}},null,2),l("p",It,J(i.message.message),1)]),l("div",kt,[n(c,{label:"Cancel",class:"mr-3 p-button-text text-500",onClick:e.closePopup},null,8,["onClick"]),n(c,{label:"Send",class:"mr-4",onClick:e.sendPush},null,8,["onClick"])])]),_:1}),n(F,{group:"notification-group",id:"notification-group"},{message:z(()=>[l("div",Dt,[Ft,l("p",null," Last push sent at: "+J(e.formatDataFromISO(e.newsDetail.last_notification_at)),1)])]),_:1})])}const Jt=se(rt,[["render",Nt]]);export{Jt as default};

import{a as We,d as ul,w as Ee}from"./runtime-dom.esm-bundler40505.js";import{ae as je,ah as ct,ai as ze,aq as ut,at as dl,ad as fl,b as de,l as mt,e as h,f as m,g as r,w as Me,v as T,i as B,m as $,s as ue,j as k,F as qe,C as V,A as K,y as yt,x as dt,h as p,d as pl,u as hl,af as vl,c as Ue,r as v,o as gl,z as C,am as A,ar as ml,as as yl,n as bl}from"./usetoast.esm40505.js";import{e as E}from"./helpers40505.js";import{u as _l,s as bt,e as xl,h as kl,g as wl,k as Sl,R as Cl,i as Al,b as Dl,l as ft,f as Ce,j,m as Be}from"./index.esm40505.js";import{D as te,O as Fl}from"./utils.esm40505.js";import{A as He}from"./AudienceCard40505.js";import{u as Tl}from"./user40505.js";import{u as Kl}from"./group40505.js";import{_ as Nl}from"./_plugin-vue_export-helper40505.js";class z{static async fetchRepositoryList(e){const l=e?`/repository/list?path=${encodeURIComponent(e)}`:"/repository/list";return(await je(l)).data}static async getPreviewUrl(e,l="high"){return(await je(`/repository/preview?id=${encodeURIComponent(e)}&resolution=${l}`)).data}static async getDownloadUrl(e,l="high"){return(await je(`/repository/download?id=${encodeURIComponent(e)}&resolution=${l}&disposition=attachment`)).data}static async getUploadUrl(e,l,o,u,s,g){const _={path:e,file_name:l,content_type:o,resolution:u};return g!==void 0&&(_.preview_only=g),s&&(s.target_all!==void 0&&(_.target_all=s.target_all),s.target_clusters&&s.target_clusters.length>0&&(_.target_clusters=s.target_clusters),s.target_group_ids&&s.target_group_ids.length>0&&(_.target_group_ids=s.target_group_ids)),(await ct("/repository/upload_url",_)).data}static async uploadFileToS3(e,l,o){const u=await fetch(e,{method:"PUT",body:l,headers:{"Content-Type":o}});if(!u.ok)throw new Error(`Upload failed: ${u.statusText}`);return u}static async renameFolder(e,l){const o=new Map;o.set("old_path",e),o.set("new_name",l);const u=Object.fromEntries(o);return(await ze("/repository/rename_folder",u)).data}static async createFolder(e,l){return(await ct("/repository/create_folder",{path:e,name:l})).data}static async deleteFolder(e){return(await ut(`/repository/delete_folder?path=${encodeURIComponent(e)}`)).data}static async uploadFiles(e){return(await dl("/repository/upload",e)).data}static async renameFile(e,l){const o=new Map;o.set("id",e),o.set("new_name",l);const u=Object.fromEntries(o);return(await ze("/repository/rename_file",u)).data}static async updateAudience(e,l,o){const u={id:e};return l.target_all!==void 0&&(u.target_all=l.target_all),l.target_clusters&&l.target_clusters.length>0&&(u.target_clusters=l.target_clusters),l.target_group_ids&&l.target_group_ids.length>0&&(u.target_group_ids=l.target_group_ids),o!==void 0&&(u.preview_only=o),(await ze("/repository/update_audience",u)).data}static async deleteFile(e,l){let o=`/repository/delete_file?id=${encodeURIComponent(e)}`;return l&&(o+=`&resolution=${l}`),(await ut(o)).data}}const Il=fl({id:"repository",state:()=>({repositoryData:null}),getters:{getRepositoryData:t=>t.repositoryData},actions:{async fetchRepositoryList(t){const e=await z.fetchRepositoryList(t);return this.repositoryData=e,e},async getPreviewUrl(t,e="high"){return await z.getPreviewUrl(t,e)},async getDownloadUrl(t,e="high"){return await z.getDownloadUrl(t,e)},async getUploadUrl(t,e,l,o,u,s){return await z.getUploadUrl(t,e,l,o,u,s)},async uploadFileToS3(t,e,l){return await z.uploadFileToS3(t,e,l)},async renameFolder(t,e){return await z.renameFolder(t,e)},async createFolder(t,e){return await z.createFolder(t,e)},async deleteFolder(t){return await z.deleteFolder(t)},async renameFile(t,e){return await z.renameFile(t,e)},async updateAudience(t,e,l){return await z.updateAudience(t,e,l)},async deleteFile(t,e){return await z.deleteFile(t,e)}}});var El=`
.p-tree-container {
    margin: 0;
    padding: 0;
    list-style-type: none;
    overflow: auto;
}

.p-treenode-children {
    margin: 0;
    padding: 0;
    list-style-type: none;
}

.p-tree-wrapper {
    overflow: auto;
}

.p-treenode-selectable {
    cursor: pointer;
    user-select: none;
}

.p-tree-toggler {
    cursor: pointer;
    user-select: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
    flex-shrink: 0;
}

.p-treenode-leaf > .p-treenode-content .p-tree-toggler {
    visibility: hidden;
}

.p-treenode-content {
    display: flex;
    align-items: center;
}

.p-tree-filter {
    width: 100%;
}

.p-tree-filter-container {
    position: relative;
    display: block;
    width: 100%;
}

.p-tree-filter-icon {
    position: absolute;
    top: 50%;
    margin-top: -0.5rem;
}

.p-tree-loading {
    position: relative;
    min-height: 4rem;
}

.p-tree .p-tree-loading-overlay {
    position: absolute;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
}

.p-tree-flex-scrollable {
    display: flex;
    flex: 1;
    height: 100%;
    flex-direction: column;
}

.p-tree-flex-scrollable .p-tree-wrapper {
    flex: 1;
}
`,Ul={root:function(e){var l=e.props;return["p-tree p-component",{"p-tree-selectable":l.selectionMode!=null,"p-tree-loading":l.loading,"p-tree-flex-scrollable":l.scrollHeight==="flex"}]},loadingOverlay:"p-tree-loading-overlay p-component-overlay",loadingIcon:"p-tree-loading-icon",filterContainer:"p-tree-filter-container",input:"p-tree-filter p-inputtext p-component",searchIcon:"p-tree-filter-icon",wrapper:"p-tree-wrapper",container:"p-tree-container",node:function(e){var l=e.instance;return["p-treenode",{"p-treenode-leaf":l.leaf}]},content:function(e){var l=e.instance;return["p-treenode-content",l.node.styleClass,{"p-treenode-selectable":l.selectable,"p-highlight":l.checkboxMode?l.checked:l.selected}]},toggler:"p-tree-toggler p-link",togglerIcon:"p-tree-toggler-icon",checkboxContainer:"p-checkbox p-component",checkbox:function(e){var l=e.instance;return["p-checkbox-box",{"p-highlight":l.checked,"p-indeterminate":l.partialChecked}]},checkboxIcon:"p-checkbox-icon",nodeIcon:function(e){var l=e.instance;return["p-treenode-icon",l.node.icon]},label:"p-treenode-label",subgroup:"p-treenode-children"},Ml=_l(El,{name:"tree",manual:!0}),Ol=Ml.load,Vl={name:"BaseTree",extends:bt,props:{value:{type:null,default:null},expandedKeys:{type:null,default:null},selectionKeys:{type:null,default:null},selectionMode:{type:String,default:null},metaKeySelection:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},loadingIcon:{type:String,default:void 0},filter:{type:Boolean,default:!1},filterBy:{type:String,default:"label"},filterMode:{type:String,default:"lenient"},filterPlaceholder:{type:String,default:null},filterLocale:{type:String,default:void 0},scrollHeight:{type:String,default:null},level:{type:Number,default:0},"aria-labelledby":{type:String,default:null},"aria-label":{type:String,default:null}},css:{classes:Ul,loadStyle:Ol},provide:function(){return{$parentInstance:this}}};function De(t){return De=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},De(t)}function pt(t,e){var l=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!l){if(Array.isArray(t)||(l=_t(t))||e&&t&&typeof t.length=="number"){l&&(t=l);var o=0,u=function(){};return{s:u,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(y){throw y},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,g=!1,_;return{s:function(){l=l.call(t)},n:function(){var y=l.next();return s=y.done,y},e:function(y){g=!0,_=y},f:function(){try{!s&&l.return!=null&&l.return()}finally{if(g)throw _}}}}function ht(t,e){var l=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),l.push.apply(l,o)}return l}function vt(t){for(var e=1;e<arguments.length;e++){var l=arguments[e]!=null?arguments[e]:{};e%2?ht(Object(l),!0).forEach(function(o){Rl(t,o,l[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(l)):ht(Object(l)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(l,o))})}return t}function Rl(t,e,l){return e=Ll(e),e in t?Object.defineProperty(t,e,{value:l,enumerable:!0,configurable:!0,writable:!0}):t[e]=l,t}function Ll(t){var e=Pl(t,"string");return De(e)==="symbol"?e:String(e)}function Pl(t,e){if(De(t)!=="object"||t===null)return t;var l=t[Symbol.toPrimitive];if(l!==void 0){var o=l.call(t,e||"default");if(De(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Ae(t){return Bl(t)||zl(t)||_t(t)||jl()}function jl(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _t(t,e){if(t){if(typeof t=="string")return $e(t,e);var l=Object.prototype.toString.call(t).slice(8,-1);if(l==="Object"&&t.constructor&&(l=t.constructor.name),l==="Map"||l==="Set")return Array.from(t);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return $e(t,e)}}function zl(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Bl(t){if(Array.isArray(t))return $e(t)}function $e(t,e){(e==null||e>t.length)&&(e=t.length);for(var l=0,o=new Array(e);l<e;l++)o[l]=t[l];return o}var xt={name:"TreeNode",hostName:"Tree",extends:bt,emits:["node-toggle","node-click","checkbox-change"],props:{node:{type:null,default:null},expandedKeys:{type:null,default:null},selectionKeys:{type:null,default:null},selectionMode:{type:String,default:null},templates:{type:null,default:null},level:{type:Number,default:null},index:{type:Number,default:null}},nodeTouched:!1,toggleClicked:!1,mounted:function(){this.setAllNodesTabIndexes()},methods:{toggle:function(){this.$emit("node-toggle",this.node),this.toggleClicked=!0},label:function(e){return typeof e.label=="function"?e.label():e.label},onChildNodeToggle:function(e){this.$emit("node-toggle",e)},getPTOptions:function(e){return this.ptm(e,{context:{index:this.index,expanded:this.expanded,selected:this.selected,checked:this.checked,leaf:this.leaf}})},onClick:function(e){if(this.toggleClicked||te.getAttribute(e.target,'[data-pc-section="toggler"]')||te.getAttribute(e.target.parentElement,'[data-pc-section="toggler"]')){this.toggleClicked=!1;return}this.isCheckboxSelectionMode()?this.toggleCheckbox():this.$emit("node-click",{originalEvent:e,nodeTouched:this.nodeTouched,node:this.node}),this.nodeTouched=!1},onChildNodeClick:function(e){this.$emit("node-click",e)},onTouchEnd:function(){this.nodeTouched=!0},onKeyDown:function(e){if(this.isSameNode(e))switch(e.code){case"Tab":this.onTabKey(e);break;case"ArrowDown":this.onArrowDown(e);break;case"ArrowUp":this.onArrowUp(e);break;case"ArrowRight":this.onArrowRight(e);break;case"ArrowLeft":this.onArrowLeft(e);break;case"Enter":case"Space":this.onEnterKey(e);break}},onArrowDown:function(e){var l=e.target.getAttribute("data-pc-section")==="toggler"?e.target.closest('[role="treeitem"]'):e.target,o=l.children[1];if(o)this.focusRowChange(l,o.children[0]);else if(l.nextElementSibling)this.focusRowChange(l,l.nextElementSibling);else{var u=this.findNextSiblingOfAncestor(l);u&&this.focusRowChange(l,u)}e.preventDefault()},onArrowUp:function(e){var l=e.target;if(l.previousElementSibling)this.focusRowChange(l,l.previousElementSibling,this.findLastVisibleDescendant(l.previousElementSibling));else{var o=this.getParentNodeElement(l);o&&this.focusRowChange(l,o)}e.preventDefault()},onArrowRight:function(e){var l=this;this.leaf||this.expanded||(e.currentTarget.tabIndex=-1,this.$emit("node-toggle",this.node),this.$nextTick(function(){l.onArrowDown(e)}))},onArrowLeft:function(e){var l=te.findSingle(e.currentTarget,'[data-pc-section="toggler"]');if(this.level===0&&!this.expanded)return!1;if(this.expanded&&!this.leaf)return l.click(),!1;var o=this.findBeforeClickableNode(e.currentTarget);o&&this.focusRowChange(e.currentTarget,o)},onEnterKey:function(e){this.setTabIndexForSelectionMode(e,this.nodeTouched),this.onClick(e),e.preventDefault()},onTabKey:function(){this.setAllNodesTabIndexes()},setAllNodesTabIndexes:function(){var e=te.find(this.$refs.currentNode.closest('[data-pc-section="container"]'),'[role="treeitem"]'),l=Ae(e).some(function(u){return u.getAttribute("aria-selected")==="true"||u.getAttribute("aria-checked")==="true"});if(Ae(e).forEach(function(u){u.tabIndex=-1}),l){var o=Ae(e).filter(function(u){return u.getAttribute("aria-selected")==="true"||u.getAttribute("aria-checked")==="true"});o[0].tabIndex=0;return}Ae(e)[0].tabIndex=0},setTabIndexForSelectionMode:function(e,l){if(this.selectionMode!==null){var o=Ae(te.find(this.$refs.currentNode.parentElement,'[role="treeitem"]'));e.currentTarget.tabIndex=l===!1?-1:0,o.every(function(u){return u.tabIndex===-1})&&(o[0].tabIndex=0)}},focusRowChange:function(e,l,o){e.tabIndex="-1",l.tabIndex="0",this.focusNode(o||l)},findBeforeClickableNode:function(e){var l=e.closest("ul").closest("li");if(l){var o=te.findSingle(l,"button");return o&&o.style.visibility!=="hidden"?l:this.findBeforeClickableNode(e.previousElementSibling)}return null},toggleCheckbox:function(){var e=this.selectionKeys?vt({},this.selectionKeys):{},l=!this.checked;this.propagateDown(this.node,l,e),this.$emit("checkbox-change",{node:this.node,check:l,selectionKeys:e})},propagateDown:function(e,l,o){if(l?o[e.key]={checked:!0,partialChecked:!1}:delete o[e.key],e.children&&e.children.length){var u=pt(e.children),s;try{for(u.s();!(s=u.n()).done;){var g=s.value;this.propagateDown(g,l,o)}}catch(_){u.e(_)}finally{u.f()}}},propagateUp:function(e){var l=e.check,o=vt({},e.selectionKeys),u=0,s=!1,g=pt(this.node.children),_;try{for(g.s();!(_=g.n()).done;){var d=_.value;o[d.key]&&o[d.key].checked?u++:o[d.key]&&o[d.key].partialChecked&&(s=!0)}}catch(y){g.e(y)}finally{g.f()}l&&u===this.node.children.length?o[this.node.key]={checked:!0,partialChecked:!1}:(l||delete o[this.node.key],s||u>0&&u!==this.node.children.length?o[this.node.key]={checked:!1,partialChecked:!0}:delete o[this.node.key]),this.$emit("checkbox-change",{node:e.node,check:e.check,selectionKeys:o})},onChildCheckboxChange:function(e){this.$emit("checkbox-change",e)},findNextSiblingOfAncestor:function(e){var l=this.getParentNodeElement(e);return l?l.nextElementSibling?l.nextElementSibling:this.findNextSiblingOfAncestor(l):null},findLastVisibleDescendant:function(e){var l=e.children[1];if(l){var o=l.children[l.children.length-1];return this.findLastVisibleDescendant(o)}else return e},getParentNodeElement:function(e){var l=e.parentElement.parentElement;return te.getAttribute(l,"role")==="treeitem"?l:null},focusNode:function(e){e.focus()},isCheckboxSelectionMode:function(){return this.selectionMode==="checkbox"},isSameNode:function(e){return e.currentTarget&&(e.currentTarget.isSameNode(e.target)||e.currentTarget.isSameNode(e.target.closest('[role="treeitem"]')))}},computed:{hasChildren:function(){return this.node.children&&this.node.children.length>0},expanded:function(){return this.expandedKeys&&this.expandedKeys[this.node.key]===!0},leaf:function(){return this.node.leaf===!1?!1:!(this.node.children&&this.node.children.length)},selectable:function(){return this.node.selectable===!1?!1:this.selectionMode!=null},selected:function(){return this.selectionMode&&this.selectionKeys?this.selectionKeys[this.node.key]===!0:!1},checkboxMode:function(){return this.selectionMode==="checkbox"&&this.node.selectable!==!1},checked:function(){return this.selectionKeys?this.selectionKeys[this.node.key]&&this.selectionKeys[this.node.key].checked:!1},partialChecked:function(){return this.selectionKeys?this.selectionKeys[this.node.key]&&this.selectionKeys[this.node.key].partialChecked:!1},ariaChecked:function(){return this.selectionMode==="single"||this.selectionMode==="multiple"?this.selected:void 0},ariaSelected:function(){return this.checkboxMode?this.checked:void 0}},components:{ChevronDownIcon:xl,ChevronRightIcon:kl,CheckIcon:wl,MinusIcon:Sl},directives:{ripple:Cl}},Hl=["aria-label","aria-selected","aria-expanded","aria-setsize","aria-posinset","aria-level","aria-checked","tabindex"],Gl=["data-p-highlight","data-p-selectable"],Wl=["data-p-checked","data-p-partialchecked"];function ql(t,e,l,o,u,s){var g=de("TreeNode",!0),_=mt("ripple");return h(),m("li",T({ref:"currentNode",class:t.cx("node"),role:"treeitem","aria-label":s.label(l.node),"aria-selected":s.ariaSelected,"aria-expanded":s.expanded,"aria-setsize":l.node.children?l.node.children.length:0,"aria-posinset":l.index+1,"aria-level":l.level,"aria-checked":s.ariaChecked,tabindex:l.index===0?0:-1,onKeydown:e[4]||(e[4]=function(){return s.onKeyDown&&s.onKeyDown.apply(s,arguments)})},l.level===1?s.getPTOptions("node"):t.ptm("subgroup")),[r("div",T({class:t.cx("content"),onClick:e[2]||(e[2]=function(){return s.onClick&&s.onClick.apply(s,arguments)}),onTouchend:e[3]||(e[3]=function(){return s.onTouchEnd&&s.onTouchEnd.apply(s,arguments)}),style:l.node.style},s.getPTOptions("content"),{"data-p-highlight":s.checkboxMode?s.checked:s.selected,"data-p-selectable":s.selectable}),[Me((h(),m("button",T({type:"button",class:t.cx("toggler"),onClick:e[0]||(e[0]=function(){return s.toggle&&s.toggle.apply(s,arguments)}),tabindex:"-1","aria-hidden":"true"},s.getPTOptions("toggler")),[l.templates.togglericon?(h(),B(ue(l.templates.togglericon),{key:0,node:l.node,expanded:s.expanded,class:$(t.cx("togglerIcon"))},null,8,["node","expanded","class"])):s.expanded?(h(),B(ue(l.node.expandedIcon?"span":"ChevronDownIcon"),T({key:1,class:t.cx("togglerIcon")},s.getPTOptions("togglerIcon")),null,16,["class"])):(h(),B(ue(l.node.collapsedIcon?"span":"ChevronRightIcon"),T({key:2,class:t.cx("togglerIcon")},s.getPTOptions("togglerIcon")),null,16,["class"]))],16)),[[_]]),s.checkboxMode?(h(),m("div",T({key:0,class:t.cx("checkboxContainer"),"aria-hidden":"true"},s.getPTOptions("checkboxContainer")),[r("div",T({class:t.cx("checkbox"),role:"checkbox"},s.getPTOptions("checkbox"),{"data-p-checked":s.checked,"data-p-partialchecked":s.partialChecked}),[l.templates.checkboxicon?(h(),B(ue(l.templates.checkboxicon),{key:0,checked:s.checked,partialChecked:s.partialChecked,class:$(t.cx("checkboxIcon"))},null,8,["checked","partialChecked","class"])):(h(),B(ue(s.checked?"CheckIcon":s.partialChecked?"MinusIcon":null),T({key:1,class:t.cx("checkboxIcon")},s.getPTOptions("checkboxIcon")),null,16,["class"]))],16,Wl)],16)):k("",!0),r("span",T({class:t.cx("nodeIcon")},s.getPTOptions("nodeIcon")),null,16),r("span",T({class:t.cx("label")},s.getPTOptions("label"),{onKeydown:e[1]||(e[1]=We(function(){},["stop"]))}),[l.templates[l.node.type]||l.templates.default?(h(),B(ue(l.templates[l.node.type]||l.templates.default),{key:0,node:l.node},null,8,["node"])):(h(),m(qe,{key:1},[V(K(s.label(l.node)),1)],64))],16)],16,Gl),s.hasChildren&&s.expanded?(h(),m("ul",T({key:0,class:t.cx("subgroup"),role:"group"},t.ptm("subgroup")),[(h(!0),m(qe,null,yt(l.node.children,function(d){return h(),B(g,{key:d.key,node:d,templates:l.templates,level:l.level+1,expandedKeys:l.expandedKeys,onNodeToggle:s.onChildNodeToggle,onNodeClick:s.onChildNodeClick,selectionMode:l.selectionMode,selectionKeys:l.selectionKeys,onCheckboxChange:s.propagateUp,pt:t.pt},null,8,["node","templates","level","expandedKeys","onNodeToggle","onNodeClick","selectionMode","selectionKeys","onCheckboxChange","pt"])}),128))],16)):k("",!0)],16,Hl)}xt.render=ql;function Fe(t){return Fe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fe(t)}function Ge(t,e){var l=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!l){if(Array.isArray(t)||(l=kt(t))||e&&t&&typeof t.length=="number"){l&&(t=l);var o=0,u=function(){};return{s:u,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(y){throw y},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,g=!1,_;return{s:function(){l=l.call(t)},n:function(){var y=l.next();return s=y.done,y},e:function(y){g=!0,_=y},f:function(){try{!s&&l.return!=null&&l.return()}finally{if(g)throw _}}}}function $l(t){return Xl(t)||Ql(t)||kt(t)||Jl()}function Jl(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kt(t,e){if(t){if(typeof t=="string")return Je(t,e);var l=Object.prototype.toString.call(t).slice(8,-1);if(l==="Object"&&t.constructor&&(l=t.constructor.name),l==="Map"||l==="Set")return Array.from(t);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return Je(t,e)}}function Ql(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Xl(t){if(Array.isArray(t))return Je(t)}function Je(t,e){(e==null||e>t.length)&&(e=t.length);for(var l=0,o=new Array(e);l<e;l++)o[l]=t[l];return o}function gt(t,e){var l=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),l.push.apply(l,o)}return l}function le(t){for(var e=1;e<arguments.length;e++){var l=arguments[e]!=null?arguments[e]:{};e%2?gt(Object(l),!0).forEach(function(o){Yl(t,o,l[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(l)):gt(Object(l)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(l,o))})}return t}function Yl(t,e,l){return e=Zl(e),e in t?Object.defineProperty(t,e,{value:l,enumerable:!0,configurable:!0,writable:!0}):t[e]=l,t}function Zl(t){var e=en(t,"string");return Fe(e)==="symbol"?e:String(e)}function en(t,e){if(Fe(t)!=="object"||t===null)return t;var l=t[Symbol.toPrimitive];if(l!==void 0){var o=l.call(t,e||"default");if(Fe(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var wt={name:"Tree",extends:Vl,emits:["node-expand","node-collapse","update:expandedKeys","update:selectionKeys","node-select","node-unselect"],data:function(){return{d_expandedKeys:this.expandedKeys||{},filterValue:null}},watch:{expandedKeys:function(e){this.d_expandedKeys=e}},methods:{onNodeToggle:function(e){var l=e.key;this.d_expandedKeys[l]?(delete this.d_expandedKeys[l],this.$emit("node-collapse",e)):(this.d_expandedKeys[l]=!0,this.$emit("node-expand",e)),this.d_expandedKeys=le({},this.d_expandedKeys),this.$emit("update:expandedKeys",this.d_expandedKeys)},onNodeClick:function(e){if(this.selectionMode!=null&&e.node.selectable!==!1){var l=e.nodeTouched?!1:this.metaKeySelection,o=l?this.handleSelectionWithMetaKey(e):this.handleSelectionWithoutMetaKey(e);this.$emit("update:selectionKeys",o)}},onCheckboxChange:function(e){this.$emit("update:selectionKeys",e.selectionKeys),e.check?this.$emit("node-select",e.node):this.$emit("node-unselect",e.node)},handleSelectionWithMetaKey:function(e){var l=e.originalEvent,o=e.node,u=l.metaKey||l.ctrlKey,s=this.isNodeSelected(o),g;return s&&u?(this.isSingleSelectionMode()?g={}:(g=le({},this.selectionKeys),delete g[o.key]),this.$emit("node-unselect",o)):(this.isSingleSelectionMode()?g={}:this.isMultipleSelectionMode()&&(g=u?this.selectionKeys?le({},this.selectionKeys):{}:{}),g[o.key]=!0,this.$emit("node-select",o)),g},handleSelectionWithoutMetaKey:function(e){var l=e.node,o=this.isNodeSelected(l),u;return this.isSingleSelectionMode()?o?(u={},this.$emit("node-unselect",l)):(u={},u[l.key]=!0,this.$emit("node-select",l)):o?(u=le({},this.selectionKeys),delete u[l.key],this.$emit("node-unselect",l)):(u=this.selectionKeys?le({},this.selectionKeys):{},u[l.key]=!0,this.$emit("node-select",l)),u},isSingleSelectionMode:function(){return this.selectionMode==="single"},isMultipleSelectionMode:function(){return this.selectionMode==="multiple"},isNodeSelected:function(e){return this.selectionMode&&this.selectionKeys?this.selectionKeys[e.key]===!0:!1},isChecked:function(e){return this.selectionKeys?this.selectionKeys[e.key]&&this.selectionKeys[e.key].checked:!1},isNodeLeaf:function(e){return e.leaf===!1?!1:!(e.children&&e.children.length)},onFilterKeydown:function(e){e.code==="Enter"&&e.preventDefault()},findFilteredNodes:function(e,l){if(e){var o=!1;if(e.children){var u=$l(e.children);e.children=[];var s=Ge(u),g;try{for(s.s();!(g=s.n()).done;){var _=g.value,d=le({},_);this.isFilterMatched(d,l)&&(o=!0,e.children.push(d))}}catch(y){s.e(y)}finally{s.f()}}if(o)return!0}},isFilterMatched:function(e,l){var o=l.searchFields,u=l.filterText,s=l.strict,g=!1,_=Ge(o),d;try{for(_.s();!(d=_.n()).done;){var y=d.value,w=String(Fl.resolveFieldData(e,y)).toLocaleLowerCase(this.filterLocale);w.indexOf(u)>-1&&(g=!0)}}catch(Te){_.e(Te)}finally{_.f()}return(!g||s&&!this.isNodeLeaf(e))&&(g=this.findFilteredNodes(e,{searchFields:o,filterText:u,strict:s})||g),g}},computed:{filteredValue:function(){var e=[],l=this.filterBy.split(","),o=this.filterValue.trim().toLocaleLowerCase(this.filterLocale),u=this.filterMode==="strict",s=Ge(this.value),g;try{for(s.s();!(g=s.n()).done;){var _=g.value,d=le({},_),y={searchFields:l,filterText:o,strict:u};(u&&(this.findFilteredNodes(d,y)||this.isFilterMatched(d,y))||!u&&(this.isFilterMatched(d,y)||this.findFilteredNodes(d,y)))&&e.push(d)}}catch(w){s.e(w)}finally{s.f()}return e},valueToRender:function(){return this.filterValue&&this.filterValue.trim().length>0?this.filteredValue:this.value}},components:{TreeNode:xt,SearchIcon:Al,SpinnerIcon:Dl}},tn=["placeholder"],ln=["aria-labelledby","aria-label"];function nn(t,e,l,o,u,s){var g=de("SpinnerIcon"),_=de("SearchIcon"),d=de("TreeNode");return h(),m("div",T({class:t.cx("root")},t.ptm("root"),{"data-pc-name":"tree"}),[t.loading?(h(),m("div",T({key:0,class:t.cx("loadingOverlay")},t.ptm("loadingOverlay")),[dt(t.$slots,"loadingicon",{class:$(t.cx("loadingIcon"))},function(){return[t.loadingIcon?(h(),m("i",T({key:0,class:[t.cx("loadingIcon"),"pi-spin",t.loadingIcon]},t.ptm("loadingIcon")),null,16)):(h(),B(g,T({key:1,spin:"",class:t.cx("loadingIcon")},t.ptm("loadingIcon")),null,16,["class"]))]})],16)):k("",!0),t.filter?(h(),m("div",T({key:1,class:t.cx("filterContainer")},t.ptm("filterContainer")),[Me(r("input",T({"onUpdate:modelValue":e[0]||(e[0]=function(y){return u.filterValue=y}),type:"text",autocomplete:"off",class:t.cx("input"),placeholder:t.filterPlaceholder,onKeydown:e[1]||(e[1]=function(){return s.onFilterKeydown&&s.onFilterKeydown.apply(s,arguments)})},t.ptm("filterinput")),null,16,tn),[[ul,u.filterValue]]),dt(t.$slots,"searchicon",{class:$(t.cx("searchIcon"))},function(){return[p(_,T({class:t.cx("searchIcon")},t.ptm("searchIcon")),null,16,["class"])]})],16)):k("",!0),r("div",T({class:t.cx("wrapper"),style:{maxHeight:t.scrollHeight}},t.ptm("wrapper")),[r("ul",T({class:t.cx("container"),role:"tree","aria-labelledby":t.ariaLabelledby,"aria-label":t.ariaLabel},t.ptm("container")),[(h(!0),m(qe,null,yt(s.valueToRender,function(y,w){return h(),B(d,{key:y.key,node:y,templates:t.$slots,level:t.level+1,index:w,expandedKeys:u.d_expandedKeys,onNodeToggle:s.onNodeToggle,onNodeClick:s.onNodeClick,selectionMode:t.selectionMode,selectionKeys:t.selectionKeys,onCheckboxChange:s.onCheckboxChange,pt:t.pt,unstyled:t.unstyled},null,8,["node","templates","level","index","expandedKeys","onNodeToggle","onNodeClick","selectionMode","selectionKeys","onCheckboxChange","pt","unstyled"])}),128))],16,ln)],16)],16)}wt.render=nn;const x=t=>(ml("data-v-ab7cb192"),t=t(),yl(),t),an={class:"flex justify-content-between align-items-center"},on=x(()=>r("h1",{class:"uppercase"},"Tabelle di Lubrificazione & Comunicazione",-1)),sn={class:"mt-4"},rn={key:0,class:"text-center p-4"},cn=x(()=>r("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2rem"}},null,-1)),un=[cn],dn=["onClick"],fn={class:"flex align-items-center flex-grow-1 gap-2"},pn={key:0,class:"flex gap-1 align-items-center"},hn={key:0,class:"text-xs px-2 py-1 border-round",style:{"background-color":"var(--green-100)",color:"var(--green-700)"}},vn={key:1,class:"text-xs px-2 py-1 border-round",style:{"background-color":"var(--blue-100)",color:"var(--blue-700)"}},gn={key:2,class:"text-xs px-2 py-1 border-round flex align-items-center gap-1",style:{"background-color":"var(--green-100)",color:"var(--green-700)"}},mn={key:0,class:"pi pi-lock-open text-green-500",style:{"font-size":"0.9rem"}},yn={key:3,class:"text-xs px-2 py-1 border-round flex align-items-center gap-1",style:{"background-color":"var(--orange-100)",color:"var(--orange-700)"}},bn=x(()=>r("i",{class:"pi pi-lock text-orange-500",style:{"font-size":"0.9rem"}},null,-1)),_n={key:4,class:"text-xs px-2 py-1 border-round flex align-items-center gap-1",style:{"background-color":"var(--orange-100)",color:"var(--orange-700)"}},xn=x(()=>r("i",{class:"pi pi-eye",style:{"font-size":"0.75rem"}},null,-1)),kn={class:"flex flex-column gap-3"},wn=x(()=>r("label",{for:"folderName"},"Nome cartella",-1)),Sn={class:"flex flex-column gap-3"},Cn=x(()=>r("label",{for:"subfolderName"},"Nome sottocartella",-1)),An={class:"flex flex-column gap-3"},Dn=x(()=>r("label",{for:"rootFolderName"},"Nome cartella",-1)),Fn={class:"flex align-items-center gap-3"},Tn=x(()=>r("i",{class:"pi pi-exclamation-triangle",style:{"font-size":"2rem",color:"var(--red-500)"}},null,-1)),Kn={key:0},Nn={class:"flex flex-column gap-4"},In={class:"flex flex-column gap-2"},En=x(()=>r("label",{for:"fileName",class:"font-semibold"},[V("Nome file "),r("span",{class:"text-red-500"},"*")],-1)),Un=x(()=>r("small",{class:"text-500"},"Il nome deve includere l'estensione del file",-1)),Mn={class:"flex flex-column gap-2"},On=x(()=>r("label",{for:"fileUploadHigh",class:"font-semibold"},"File in alta risoluzione",-1)),Vn=["disabled"],Rn={key:0,class:"mt-2 p-2 surface-100 border-round"},Ln={class:"flex align-items-center gap-2"},Pn=x(()=>r("i",{class:"pi pi-file text-green-500"},null,-1)),jn={class:"text-sm"},zn={class:"text-xs text-500"},Bn={class:"flex flex-column gap-2"},Hn=x(()=>r("label",{for:"fileUploadLow",class:"font-semibold"},"File in bassa risoluzione",-1)),Gn=["disabled"],Wn={key:0,class:"mt-2 p-2 surface-100 border-round"},qn={class:"flex align-items-center gap-2"},$n=x(()=>r("i",{class:"pi pi-file text-blue-500"},null,-1)),Jn={class:"text-sm"},Qn={class:"text-xs text-500"},Xn={key:0,class:"p-3 surface-100 border-round"},Yn=x(()=>r("div",{class:"flex align-items-center gap-2 text-orange-500"},[r("i",{class:"pi pi-info-circle"}),r("span",{class:"text-sm"},"Devi selezionare almeno un file (alta o bassa risoluzione)")],-1)),Zn=[Yn],ea={class:"field-checkbox mb-0"},ta=x(()=>r("label",{for:"uploadPreviewOnly",class:"ml-2"},"Solo anteprima",-1)),la=x(()=>r("br",null,null,-1)),na=x(()=>r("div",{class:"p-3 surface-100 border-round"},[r("div",{class:"flex align-items-center gap-2 text-orange-500"},[r("i",{class:"pi pi-info-circle"}),r("span",{class:"text-sm"},"Devi selezionare almeno un file in bassa risoluzione per far funzionare correttamente questa funzionalità")])],-1)),aa={key:1,class:"flex flex-column gap-2"},ia={class:"flex align-items-center gap-2"},oa=x(()=>r("i",{class:"pi pi-spin pi-spinner"},null,-1)),sa={class:"flex flex-column gap-3"},ra=x(()=>r("label",{for:"fileName"},"Nome file",-1)),ca=x(()=>r("small",{class:"text-500"},"Il nome deve includere l'estensione del file",-1)),ua={class:"flex align-items-center gap-3"},da=x(()=>r("i",{class:"pi pi-exclamation-triangle",style:{"font-size":"2rem",color:"var(--red-500)"}},null,-1)),fa={key:0},pa={class:"m-0"},ha={key:0,class:"m-0 mt-2 text-500 text-sm"},va={key:0,class:"text-green-600 font-semibold"},ga={key:1},ma={key:2,class:"text-blue-600 font-semibold"},ya={class:"flex align-items-center gap-3"},ba=x(()=>r("i",{class:"pi pi-exclamation-triangle",style:{"font-size":"2rem",color:"var(--red-500)"}},null,-1)),_a={key:0},xa={class:"m-0"},ka={key:0,class:"m-0 mt-2 text-500 text-sm"},wa={key:1,class:"m-0 mt-2 text-orange-600 text-sm"},Sa={class:"flex flex-column gap-4"},Ca={key:0,class:"p-3 surface-100 border-round"},Aa={class:"flex align-items-center gap-2"},Da=x(()=>r("i",{class:"pi pi-file"},null,-1)),Fa={class:"font-semibold"},Ta={class:"flex flex-column gap-2"},Ka={for:"fileUploadVersion",class:"font-semibold"},Na=["disabled"],Ia={key:0,class:"mt-2 p-2 surface-100 border-round"},Ea={class:"flex align-items-center gap-2"},Ua={class:"text-sm"},Ma={class:"text-xs text-500"},Oa={class:"field-checkbox mb-0"},Va=x(()=>r("label",{for:"uploadVersionPreviewOnly",class:"ml-2"},"Solo anteprima",-1)),Ra=x(()=>r("div",{class:"p-3 surface-100 border-round"},[r("div",{class:"flex align-items-center gap-2 text-orange-500"},[r("i",{class:"pi pi-info-circle"}),r("span",{class:"text-sm"},"Devi selezionare almeno un file in bassa risoluzione per far funzionare correttamente questa funzionalità")])],-1)),La={key:1,class:"flex flex-column gap-2"},Pa={class:"flex align-items-center gap-2"},ja=x(()=>r("i",{class:"pi pi-spin pi-spinner"},null,-1)),za={class:"flex flex-column gap-4"},Ba={key:0,class:"p-3 surface-100 border-round"},Ha={class:"flex align-items-center gap-2"},Ga=x(()=>r("i",{class:"pi pi-file"},null,-1)),Wa={class:"font-semibold"},qa={class:"flex flex-column gap-4"},$a={key:0,class:"p-3 surface-100 border-round"},Ja={class:"flex align-items-center gap-2"},Qa=x(()=>r("i",{class:"pi pi-file"},null,-1)),Xa={class:"font-semibold"},Ya={class:"field-checkbox mb-0"},Za=x(()=>r("label",{for:"editFilePreviewOnly",class:"ml-2"},"Solo anteprima",-1)),ei=x(()=>r("div",{class:"p-3 surface-100 border-round"},[r("div",{class:"flex align-items-center gap-2 text-orange-500"},[r("i",{class:"pi pi-info-circle"}),r("span",{class:"text-sm"},"Devi selezionare almeno un file in bassa risoluzione per far funzionare correttamente questa funzionalità")])],-1)),ti=pl({__name:"RepositoryView",setup(t){const e=Il(),l=Tl(),o=Kl(),u=hl(),s=vl(),g=Ue(()=>{var a;return((a=u.getSelectedCountry)==null?void 0:a.country_code)==="IT"?l.userRolesItaly:l.userRoles}),_=Ue(()=>o.allGroups),d=v([]),y=v(!1),w=v({}),Te=v(),Qe=v(),S=v(null),f=v(null),fe=v(!1),ne=v(""),J=v(!1),pe=v(!1),ae=v(""),Q=v(!1),he=v(!1),ie=v(""),X=v(!1),ve=v(!1),oe=v(""),Y=v(!1),ge=v(!1),se=v(!1),me=v(!1),ye=v(!1),G=v("high"),R=v(!1),be=v(!1),_e=v(!1),xe=v("high"),F=v(!1),H=v(""),U=v(null),M=v(null),P=v(null),Oe=v(null),Ve=v(null),Re=v(null),L=v(""),Z=v(!1),Xe=v(),Ye=v(),re=v(!1),ke=v(!1),Ke=v(),ce=v(!1),we=v(!1),Ne=v(!1),ee=v(!1),St=Ue(()=>{var a;return(a=f.value)!=null&&a.fileData?G.value==="high"?f.value.fileData.has_low:f.value.fileData.has_high:!1}),Ct=v([{label:"Rinomina",icon:"pi pi-pencil",command:()=>Vt()},{label:"Crea sottocartella",icon:"pi pi-plus",command:()=>Lt()},{label:"Carica file",icon:"pi pi-upload",command:()=>Pt()},{label:"Elimina cartella",icon:"pi pi-trash",command:()=>qt()}]),At=Ue(()=>{var n,i,b,D,c;const a=[{label:"Rinomina file",icon:"pi pi-pencil",command:()=>It()},{label:"Modifica audience",icon:"pi pi-users",command:()=>Xt()},{label:"Modifica Solo anteprima",icon:"pi pi-eye",command:()=>el()}];return(n=f.value)!=null&&n.fileData&&(f.value.fileData.has_high||a.push({label:"Carica versione ALTA",icon:"pi pi-upload",command:()=>at("high")}),f.value.fileData.has_low||a.push({label:"Carica versione BASSA",icon:"pi pi-upload",command:()=>at("low")})),(b=(i=f.value)==null?void 0:i.fileData)!=null&&b.has_high&&(a.push({separator:!0}),a.push({label:"Anteprima ALTA",icon:"pi pi-eye",command:()=>tt("high")}),a.push({label:"Scarica ALTA",icon:"pi pi-download",command:()=>lt("high")}),a.push({label:"Elimina versione ALTA",icon:"pi pi-trash",command:()=>nt("high")})),(c=(D=f.value)==null?void 0:D.fileData)!=null&&c.has_low&&(a.push({separator:!0}),a.push({label:"Anteprima BASSA",icon:"pi pi-eye",command:()=>tt("low")}),a.push({label:"Scarica BASSA",icon:"pi pi-download",command:()=>lt("low")}),a.push({label:"Elimina versione BASSA",icon:"pi pi-trash",command:()=>nt("low")})),a.push({separator:!0}),a.push({label:"Elimina file",icon:"pi pi-trash",class:"text-red-500",command:()=>Et()}),a});function Le(a){if(a===0)return"0 Bytes";const n=1024,i=["Bytes","KB","MB","GB"],b=Math.floor(Math.log(a)/Math.log(n));return parseFloat((a/Math.pow(n,b)).toFixed(2))+" "+i[b]}async function N(a){try{y.value=!0,console.log("Loading repository data for path:",a);const n=await e.fetchRepositoryList(a);return console.log("Repository data loaded:",n),n}catch(n){return console.error("Error loading repository data:",n),E(s,n),null}finally{y.value=!1}}function I(a){const n=[];return a.folders&&a.folders.length>0&&a.folders.forEach(i=>{const b=i.file_count>0?`${i.name} (${i.file_count} file)`:i.name;n.push({key:i.path,label:b,icon:"pi pi-folder",type:i.type,path:i.path,file_count:i.file_count,leaf:!1})}),a.files&&a.files.length>0&&a.files.forEach(i=>{n.push({key:i.id,label:i.name,icon:"pi pi-file",type:i.type,path:i.path,leaf:!0,fileData:{id:i.id,name:i.name,path:i.path,high_file_name:i.high_file_name,low_file_name:i.low_file_name,high_key:i.high_key,low_key:i.low_key,has_high:i.has_high,has_low:i.has_low,preview_only:i.preview_only??!1,target_all:i.target_all,target_clusters:i.target_clusters,target_group_ids:i.target_group_ids}})}),n}function Ie(a,n){for(const i of a){if(i.path===n)return i;if(i.children){const b=Ie(i.children,n);if(b)return b}}return null}function Ze(a){const n=a.split("/").filter(i=>i);return n.length<=1?null:(n.pop(),n.join("/"))}async function Dt(a,n=!1){const i=Ze(a);if(i){const b=Ze(i),D=w.value[i];if(b){const c=Ie(d.value,b);if(c){const O=await N(b);if(O&&(c.children=I(O),D||n)){const q=Ie(c.children||[],i);if(q){const Se=await N(i);Se&&(q.children=I(Se))}}}}else{y.value=!0;const c=await N();if(c&&(d.value=I(c),D||n)){const O=Ie(d.value,i);if(O){const q=await N(i);q&&(O.children=I(q))}}y.value=!1}}else{y.value=!0;const b=await N();b&&(d.value=I(b)),y.value=!1}}async function Ft(a){a.leaf||(console.log("Folder clicked:",a),w.value[a.key]?delete w.value[a.key]:(w.value[a.key]=!0,await et({node:a})))}function Tt(a){console.log("Node collapsed:",a)}async function et(a){console.log("onNodeExpand called with:",a);const n=a.node||a;if(console.log("Expanding node:",n),n.type==="folder"||!n.leaf){console.log("Loading children for folder:",n.path),n.loading=!0;const i=await N(n.path);i&&(n.children=I(i),console.log("Children loaded:",n.children)),n.loading=!1}}async function tt(a){var n;if((n=f.value)!=null&&n.fileData){console.log("Opening file preview for:",f.value.fileData.id,a);try{const i=await e.getPreviewUrl(f.value.fileData.id,a);console.log("Preview URL response:",i),i&&i.url?window.open(i.url,"_blank"):typeof i=="string"&&window.open(i,"_blank")}catch(i){console.error("Error getting preview URL:",i),E(s,i)}}}async function lt(a){var n;if((n=f.value)!=null&&n.fileData){console.log("Downloading file:",f.value.fileData.id,a);try{const i=await e.getDownloadUrl(f.value.fileData.id,a);console.log("Download URL response:",i),i&&i.url?window.open(i.url,"_blank"):typeof i=="string"&&window.open(i,"_blank")}catch(i){console.error("Error getting download URL:",i),E(s,i)}}}function Kt(a,n){S.value=n,Te.value.toggle(a)}function Nt(a,n){f.value=n,Qe.value.toggle(a)}function It(){f.value&&(ae.value=f.value.label,pe.value=!0)}function Et(){f.value&&(me.value=!0)}function nt(a){f.value&&(G.value=a,ye.value=!0)}function at(a){var n;f.value&&(xe.value=a,P.value=null,re.value=((n=f.value.fileData)==null?void 0:n.preview_only)??!1,_e.value=!0)}function Ut(a){const n=a.target;n.files&&n.files.length>0&&(P.value=n.files[0])}async function Mt(){var a;if(!(!((a=f.value)!=null&&a.fileData)||!P.value||F.value))try{F.value=!0;const n=f.value.fileData.path,i=f.value.fileData.name,b=xe.value,D=Pe(Ye);H.value=`Caricamento versione ${b==="high"?"ALTA":"BASSA"}...`;const c=P.value.type||"application/octet-stream",O=await e.getUploadUrl(n,i,c,b,D,re.value);console.log("Upload URL response:",O),await e.uploadFileToS3(O.url,P.value,c),s.add({severity:"success",summary:"Successo",detail:`Versione ${b==="high"?"ALTA":"BASSA"} caricata con successo`,life:3e3}),_e.value=!1,P.value=null,re.value=!1;const q={...w.value},Se=await N();Se&&(d.value=I(Se),w.value=q,await W(d.value,q))}catch(n){console.error("Error uploading version:",n),E(s,n)}finally{F.value=!1,H.value=""}}function Ot(){_e.value=!1,P.value=null,re.value=!1,Re.value&&(Re.value.value="")}function Vt(){if(!S.value)return;const a=S.value.label,n=a.includes(" (")?a.substring(0,a.indexOf(" (")):a;ne.value=n,fe.value=!0}async function it(){if(!(!S.value||!ne.value.trim()||J.value))try{J.value=!0,await e.renameFolder(S.value.path,ne.value.trim()),s.add({severity:"success",summary:"Successo",detail:"Cartella rinominata con successo",life:3e3}),fe.value=!1,await Dt(S.value.path)}catch(a){console.error("Error renaming folder:",a),E(s,a)}finally{J.value=!1}}function Rt(){fe.value=!1,ne.value=""}function Lt(){S.value&&(ie.value="",he.value=!0)}async function ot(){if(!(!S.value||!ie.value.trim()||X.value))try{X.value=!0,await e.createFolder(S.value.path,ie.value.trim()),s.add({severity:"success",summary:"Successo",detail:"Sottocartella creata con successo",life:3e3}),he.value=!1;const a=await N(S.value.path);a&&S.value&&(S.value.children=I(a))}catch(a){console.error("Error creating subfolder:",a),E(s,a)}finally{X.value=!1}}function Pt(){S.value&&(U.value=null,M.value=null,L.value="",Z.value=!1,H.value="",be.value=!0)}function jt(a){const n=a.target;n.files&&n.files.length>0&&(U.value=n.files[0],L.value||(L.value=n.files[0].name))}function zt(a){const n=a.target;n.files&&n.files.length>0&&(M.value=n.files[0],L.value||(L.value=n.files[0].name))}function Bt(a){return a.target_clusters&&a.target_clusters.length>0||a.target_group_ids&&a.target_group_ids.length>0}function Ht(a){const n=[];if(a.target_clusters&&a.target_clusters.length>0){const i=a.target_clusters.map(b=>{const D=g.value.find(c=>c.value===b);return D?D.name:b});n.push(i.join(", "))}if(a.target_group_ids&&a.target_group_ids.length>0){const i=a.target_group_ids.map(b=>{const D=_.value.find(c=>c.id===b);return D?D.name:b});n.push("Gruppi: "+i.join(", "))}return n.join(" | ")}function Pe(a){var i;if(!((i=a.value)!=null&&i.tmp_audience))return;const n=a.value.tmp_audience;return{target_all:n.target_all,target_clusters:n.target_clusters,target_group_ids:n.target_group_ids}}async function Gt(){if(!(!S.value||!M.value&&!U.value||F.value||!L.value.trim()))try{F.value=!0;const a=S.value.path,n=L.value.trim(),i=Pe(Xe);if(M.value){H.value="Caricamento versione HIGH...";const D=M.value.type||"application/octet-stream",c=await e.getUploadUrl(a,n,D,"high",i,Z.value);console.log("Upload URL response (high):",c),await e.uploadFileToS3(c.url,M.value,D)}if(U.value){H.value="Caricamento versione LOW...";const D=U.value.type||"application/octet-stream",c=await e.getUploadUrl(a,n,D,"low",i,Z.value);console.log("Upload URL response (low):",c),await e.uploadFileToS3(c.url,U.value,D)}s.add({severity:"success",summary:"Successo",detail:"File caricato con successo",life:3e3}),be.value=!1,U.value=null,M.value=null,L.value="",Z.value=!1;const b=await N(S.value.path);b&&S.value&&(S.value.children=I(b))}catch(a){console.error("Error uploading file:",a),E(s,a)}finally{F.value=!1,H.value=""}}function Wt(){be.value=!1,U.value=null,M.value=null,L.value="",Z.value=!1,H.value="",Oe.value&&(Oe.value.value=""),Ve.value&&(Ve.value.value="")}function qt(){S.value&&(ge.value=!0)}async function $t(){if(!(!S.value||se.value))try{se.value=!0;const a=S.value.path,n={...w.value};delete n[a],await e.deleteFolder(a),s.add({severity:"success",summary:"Successo",detail:"Cartella eliminata con successo",life:3e3}),ge.value=!1;const i=await N();i&&(d.value=I(i),w.value=n,await W(d.value,n))}catch(a){console.error("Error deleting folder:",a),E(s,a)}finally{se.value=!1}}async function W(a,n){for(const i of a)if(!i.leaf&&n[i.key]){const b=await N(i.path);b&&(i.children=I(b),i.children&&await W(i.children,n))}}function Jt(){ge.value=!1}async function st(){var a;if(!(!((a=f.value)!=null&&a.fileData)||!ae.value.trim()||Q.value))try{Q.value=!0;const n={...w.value};await e.renameFile(f.value.fileData.id,ae.value.trim()),s.add({severity:"success",summary:"Successo",detail:"File rinominato con successo",life:3e3}),pe.value=!1;const i=await N();i&&(d.value=I(i),w.value=n,await W(d.value,n))}catch(n){console.error("Error renaming file:",n),E(s,n)}finally{Q.value=!1}}function Qt(){pe.value=!1,ae.value=""}function Xt(){var a;(a=f.value)!=null&&a.fileData&&(ke.value=!0,bl(()=>{if(Ke.value){const n=f.value.fileData;Ke.value.tmp_audience={target_all:n.target_all??!1,target_clusters:n.target_clusters??[],target_group_ids:n.target_group_ids??[]}}}))}async function Yt(){var a;if(!(!((a=f.value)!=null&&a.fileData)||ce.value))try{ce.value=!0;const n=Pe(Ke);await e.updateAudience(f.value.fileData.id,n||{}),s.add({severity:"success",summary:"Successo",detail:"Audience aggiornata con successo",life:3e3}),ke.value=!1;const i={...w.value},b=await N();b&&(d.value=I(b),w.value=i,await W(d.value,i))}catch(n){console.error("Error updating audience:",n),E(s,n)}finally{ce.value=!1}}function Zt(){ke.value=!1}function el(){var a;(a=f.value)!=null&&a.fileData&&(Ne.value=f.value.fileData.preview_only??!1,we.value=!0)}async function tl(){var a;if(!(!((a=f.value)!=null&&a.fileData)||ee.value))try{ee.value=!0,await e.updateAudience(f.value.fileData.id,{},Ne.value),s.add({severity:"success",summary:"Successo",detail:"Impostazione aggiornata con successo",life:3e3}),we.value=!1;const n={...w.value},i=await N();i&&(d.value=I(i),w.value=n,await W(d.value,n))}catch(n){console.error("Error updating preview_only:",n),E(s,n)}finally{ee.value=!1}}function ll(){we.value=!1}function nl(){he.value=!1,ie.value=""}function al(){oe.value="",ve.value=!0}async function rt(){if(!(!oe.value.trim()||Y.value))try{Y.value=!0,await e.createFolder("",oe.value.trim()),s.add({severity:"success",summary:"Successo",detail:"Cartella creata con successo",life:3e3}),ve.value=!1;const a=await N();a&&(d.value=I(a))}catch(a){console.error("Error creating root folder:",a),E(s,a)}finally{Y.value=!1}}function il(){ve.value=!1,oe.value=""}async function ol(){var a;if(!(!((a=f.value)!=null&&a.fileData)||R.value))try{R.value=!0;const n={...w.value};await e.deleteFile(f.value.fileData.id),s.add({severity:"success",summary:"Successo",detail:"File eliminato con successo",life:3e3}),me.value=!1;const i=await N();i&&(d.value=I(i),w.value=n,await W(d.value,n))}catch(n){console.error("Error deleting file:",n),E(s,n)}finally{R.value=!1}}function sl(){me.value=!1}async function rl(){var a;if(!(!((a=f.value)!=null&&a.fileData)||R.value))try{R.value=!0;const n={...w.value};await e.deleteFile(f.value.fileData.id,G.value),s.add({severity:"success",summary:"Successo",detail:`Versione ${G.value==="high"?"ALTA":"BASSA"} eliminata con successo`,life:3e3}),ye.value=!1;const i=await N();i&&(d.value=I(i),w.value=n,await W(d.value,n))}catch(n){console.error("Error deleting file version:",n),E(s,n)}finally{R.value=!1}}function cl(){ye.value=!1}return gl(async()=>{console.log("RepositoryView mounted");const a=await N();console.log("Initial data:",a),a&&(d.value=I(a),console.log("Tree nodes created:",d.value))}),(a,n)=>{const i=de("Button"),b=de("Card"),D=mt("tooltip");return h(),m("div",null,[p(b,null,{content:C(()=>[r("div",an,[on,p(i,{label:"Crea cartella",icon:"pi pi-plus",onClick:al})]),r("div",sn,[y.value&&d.value.length===0?(h(),m("div",rn,un)):(h(),B(A(wt),{key:1,value:d.value,loading:y.value,expandedKeys:w.value,"onUpdate:expandedKeys":n[2]||(n[2]=c=>w.value=c),onNodeExpand:et,onNodeCollapse:Tt,class:"w-full"},{default:C(c=>[r("div",{class:$(["node-content-wrapper flex align-items-center justify-content-between w-full pr-2",{"folder-row":!c.node.leaf}]),onClick:O=>Ft(c.node)},[r("div",fn,[r("span",{class:$({"font-bold":c.node.file_count&&c.node.file_count>0})},K(c.node.label),3),c.node.leaf&&c.node.fileData?(h(),m("div",pn,[c.node.fileData.has_high?(h(),m("span",hn," ALTA ")):k("",!0),c.node.fileData.has_low?(h(),m("span",vn," BASSA ")):k("",!0),c.node.fileData.target_all?Me((h(),m("span",gn,[c.node.fileData.target_all?(h(),m("i",mn)):k("",!0),V(" Audience ")])),[[D,"Tutti gli utenti",void 0,{top:!0}]]):Bt(c.node.fileData)?Me((h(),m("span",yn,[bn,V(" Audience ")])),[[D,Ht(c.node.fileData),void 0,{top:!0}]]):k("",!0),c.node.fileData.preview_only?(h(),m("span",_n,[xn,V(" Solo anteprima ")])):k("",!0)])):k("",!0)]),c.node.leaf?k("",!0):(h(),m("div",{key:0,class:"flex gap-1 ml-2",onClick:n[0]||(n[0]=We(()=>{},["stop"]))},[p(i,{icon:"pi pi-ellipsis-v",class:"p-button-icon-only p-button-text p-button-rounded p-button-sm text-primary surface-200",onClick:O=>Kt(O,c.node),title:"Opzioni cartella"},null,8,["onClick"])])),c.node.leaf?(h(),m("div",{key:1,class:"flex gap-1 ml-2",onClick:n[1]||(n[1]=We(()=>{},["stop"]))},[p(i,{icon:"pi pi-ellipsis-v",class:"p-button-icon-only p-button-text p-button-rounded p-button-sm text-primary surface-200",onClick:O=>Nt(O,c.node),title:"Opzioni file"},null,8,["onClick"])])):k("",!0)],10,dn)]),_:1},8,["value","loading","expandedKeys"]))])]),_:1}),p(A(ft),{ref_key:"folderMenu",ref:Te,model:Ct.value,popup:!0},null,8,["model"]),p(A(ft),{ref_key:"fileMenu",ref:Qe,model:A(At),popup:!0},null,8,["model"]),p(A(j),{visible:fe.value,"onUpdate:visible":n[4]||(n[4]=c=>fe.value=c),modal:!0,header:"Rinomina cartella",style:{width:"450px"}},{footer:C(()=>[p(i,{label:"Annulla",icon:"pi pi-times",onClick:Rt,disabled:J.value,text:"",class:"cancel-button"},null,8,["disabled"]),p(i,{label:"Rinomina",icon:"pi pi-check",onClick:it,loading:J.value,disabled:J.value},null,8,["loading","disabled"])]),default:C(()=>[r("div",kn,[wn,p(A(Ce),{id:"folderName",modelValue:ne.value,"onUpdate:modelValue":n[3]||(n[3]=c=>ne.value=c),onKeyup:Ee(it,["enter"]),disabled:J.value,autofocus:""},null,8,["modelValue","onKeyup","disabled"])])]),_:1},8,["visible"]),p(A(j),{visible:he.value,"onUpdate:visible":n[6]||(n[6]=c=>he.value=c),modal:!0,header:"Crea sottocartella",style:{width:"450px"}},{footer:C(()=>[p(i,{label:"Annulla",icon:"pi pi-times",onClick:nl,disabled:X.value,text:"",class:"cancel-button"},null,8,["disabled"]),p(i,{label:"Crea",icon:"pi pi-check",onClick:ot,loading:X.value,disabled:X.value},null,8,["loading","disabled"])]),default:C(()=>[r("div",Sn,[Cn,p(A(Ce),{id:"subfolderName",modelValue:ie.value,"onUpdate:modelValue":n[5]||(n[5]=c=>ie.value=c),onKeyup:Ee(ot,["enter"]),disabled:X.value,autofocus:""},null,8,["modelValue","onKeyup","disabled"])])]),_:1},8,["visible"]),p(A(j),{visible:ve.value,"onUpdate:visible":n[8]||(n[8]=c=>ve.value=c),modal:!0,header:"Crea cartella",style:{width:"450px"}},{footer:C(()=>[p(i,{label:"Annulla",icon:"pi pi-times",onClick:il,disabled:Y.value,text:"",class:"cancel-button"},null,8,["disabled"]),p(i,{label:"Crea",icon:"pi pi-check",onClick:rt,loading:Y.value,disabled:Y.value},null,8,["loading","disabled"])]),default:C(()=>[r("div",An,[Dn,p(A(Ce),{id:"rootFolderName",modelValue:oe.value,"onUpdate:modelValue":n[7]||(n[7]=c=>oe.value=c),onKeyup:Ee(rt,["enter"]),disabled:Y.value,autofocus:""},null,8,["modelValue","onKeyup","disabled"])])]),_:1},8,["visible"]),p(A(j),{visible:ge.value,"onUpdate:visible":n[9]||(n[9]=c=>ge.value=c),modal:!0,header:"Elimina cartella",style:{width:"450px"}},{footer:C(()=>[p(i,{label:"Annulla",icon:"pi pi-times",onClick:Jt,disabled:se.value,text:"",class:"cancel-button"},null,8,["disabled"]),p(i,{label:"Elimina cartella",icon:"pi pi-trash",onClick:$t,loading:se.value,disabled:se.value,severity:"danger"},null,8,["loading","disabled"])]),default:C(()=>[r("div",Fn,[Tn,S.value?(h(),m("span",Kn,[V(" Sicuro di voler eliminare la cartella "),r("strong",null,K(S.value.label.includes(" (")?S.value.label.substring(0,S.value.label.indexOf(" (")):S.value.label),1),V("? Se confermi verrà eliminata la cartella e tutto il suo contenuto. ")])):k("",!0)])]),_:1},8,["visible"]),p(A(j),{visible:be.value,"onUpdate:visible":n[12]||(n[12]=c=>be.value=c),modal:!0,header:"Carica file",style:{width:"750px"}},{footer:C(()=>[p(i,{label:"Annulla",icon:"pi pi-times",onClick:Wt,disabled:F.value,text:"",class:"cancel-button"},null,8,["disabled"]),p(i,{label:"Carica",icon:"pi pi-upload",onClick:Gt,loading:F.value,disabled:F.value||!M.value&&!U.value||!L.value.trim()},null,8,["loading","disabled"])]),default:C(()=>[r("div",Nn,[r("div",In,[En,p(A(Ce),{id:"fileName",modelValue:L.value,"onUpdate:modelValue":n[10]||(n[10]=c=>L.value=c),disabled:F.value,placeholder:"Inserisci il nome del file (es. documento.pdf)"},null,8,["modelValue","disabled"]),Un]),r("div",Mn,[On,r("input",{type:"file",id:"fileUploadHigh",ref_key:"fileInputHigh",ref:Ve,onChange:zt,disabled:F.value},null,40,Vn),M.value?(h(),m("div",Rn,[r("div",Ln,[Pn,r("span",jn,K(M.value.name),1),r("span",zn,"("+K(Le(M.value.size))+")",1)])])):k("",!0)]),r("div",Bn,[Hn,r("input",{type:"file",id:"fileUploadLow",ref_key:"fileInputLow",ref:Oe,onChange:jt,disabled:F.value},null,40,Gn),U.value?(h(),m("div",Wn,[r("div",qn,[$n,r("span",Jn,K(U.value.name),1),r("span",Qn,"("+K(Le(U.value.size))+")",1)])])):k("",!0)]),!M.value&&!U.value?(h(),m("div",Xn,Zn)):k("",!0),r("div",ea,[p(A(Be),{inputId:"uploadPreviewOnly",modelValue:Z.value,"onUpdate:modelValue":n[11]||(n[11]=c=>Z.value=c),binary:!0,disabled:F.value},null,8,["modelValue","disabled"]),ta,la]),na,p(He,{ref_key:"uploadAudienceCard",ref:Xe},null,512),F.value?(h(),m("div",aa,[r("div",ia,[oa,r("span",null,K(H.value),1)])])):k("",!0)])]),_:1},8,["visible"]),p(A(j),{visible:pe.value,"onUpdate:visible":n[14]||(n[14]=c=>pe.value=c),modal:!0,header:"Rinomina file",style:{width:"450px"}},{footer:C(()=>[p(i,{label:"Annulla",icon:"pi pi-times",onClick:Qt,disabled:Q.value,text:"",class:"cancel-button"},null,8,["disabled"]),p(i,{label:"Rinomina",icon:"pi pi-check",onClick:st,loading:Q.value,disabled:Q.value},null,8,["loading","disabled"])]),default:C(()=>[r("div",sa,[ra,p(A(Ce),{id:"fileNameInput",modelValue:ae.value,"onUpdate:modelValue":n[13]||(n[13]=c=>ae.value=c),onKeyup:Ee(st,["enter"]),disabled:Q.value,autofocus:""},null,8,["modelValue","onKeyup","disabled"]),ca])]),_:1},8,["visible"]),p(A(j),{visible:me.value,"onUpdate:visible":n[15]||(n[15]=c=>me.value=c),modal:!0,header:"Elimina file",style:{width:"500px"}},{footer:C(()=>[p(i,{label:"Annulla",icon:"pi pi-times",onClick:sl,disabled:R.value,text:"",class:"cancel-button"},null,8,["disabled"]),p(i,{label:"Elimina file",icon:"pi pi-trash",onClick:ol,loading:R.value,disabled:R.value,severity:"danger"},null,8,["loading","disabled"])]),default:C(()=>[r("div",ua,[da,f.value?(h(),m("div",fa,[r("p",pa,[V(" Sicuro di voler eliminare il file "),r("strong",null,K(f.value.label),1),V("? ")]),f.value.fileData?(h(),m("p",ha,[V(" Verranno eliminate tutte le versioni disponibili: "),f.value.fileData.has_high?(h(),m("span",va,"ALTA")):k("",!0),f.value.fileData.has_high&&f.value.fileData.has_low?(h(),m("span",ga," e ")):k("",!0),f.value.fileData.has_low?(h(),m("span",ma,"BASSA")):k("",!0)])):k("",!0)])):k("",!0)])]),_:1},8,["visible"]),p(A(j),{visible:ye.value,"onUpdate:visible":n[16]||(n[16]=c=>ye.value=c),modal:!0,header:"Elimina versione",style:{width:"500px"}},{footer:C(()=>[p(i,{label:"Annulla",icon:"pi pi-times",onClick:cl,disabled:R.value,text:"",class:"cancel-button"},null,8,["disabled"]),p(i,{label:"Elimina versione "+(G.value==="high"?"ALTA":"BASSA"),icon:"pi pi-trash",onClick:rl,loading:R.value,disabled:R.value,severity:"danger"},null,8,["label","loading","disabled"])]),default:C(()=>[r("div",ya,[ba,f.value?(h(),m("div",_a,[r("p",xa,[V(" Sicuro di voler eliminare la versione "),r("strong",{class:$(G.value==="high"?"text-green-600":"text-blue-600")},K(G.value==="high"?"ALTA":"BASSA"),3),V(" del file "),r("strong",null,K(f.value.label),1),V("? ")]),f.value.fileData&&A(St)?(h(),m("p",ka," La versione "+K(G.value==="high"?"BASSA":"ALTA")+" rimarrà disponibile. ",1)):(h(),m("p",wa," Attenzione: questa è l'unica versione disponibile. Eliminandola, il file verrà rimosso completamente. "))])):k("",!0)])]),_:1},8,["visible"]),p(A(j),{visible:_e.value,"onUpdate:visible":n[18]||(n[18]=c=>_e.value=c),modal:!0,header:"Carica versione "+(xe.value==="high"?"ALTA":"BASSA"),style:{width:"750px"}},{footer:C(()=>[p(i,{label:"Annulla",icon:"pi pi-times",onClick:Ot,disabled:F.value,text:"",class:"cancel-button"},null,8,["disabled"]),p(i,{label:"Carica",icon:"pi pi-upload",onClick:Mt,loading:F.value,disabled:F.value||!P.value},null,8,["loading","disabled"])]),default:C(()=>[r("div",Sa,[f.value?(h(),m("div",Ca,[r("div",Aa,[Da,r("span",Fa,K(f.value.label),1)])])):k("",!0),r("div",Ta,[r("label",Ka," Seleziona file versione "+K(xe.value==="high"?"ALTA":"BASSA"),1),r("input",{type:"file",id:"fileUploadVersion",ref_key:"fileInputVersion",ref:Re,onChange:Ut,disabled:F.value},null,40,Na),P.value?(h(),m("div",Ia,[r("div",Ea,[r("i",{class:$(["pi pi-file",xe.value==="high"?"text-green-500":"text-blue-500"])},null,2),r("span",Ua,K(P.value.name),1),r("span",Ma,"("+K(Le(P.value.size))+")",1)])])):k("",!0)]),r("div",Oa,[p(A(Be),{inputId:"uploadVersionPreviewOnly",modelValue:re.value,"onUpdate:modelValue":n[17]||(n[17]=c=>re.value=c),binary:!0,disabled:F.value},null,8,["modelValue","disabled"]),Va]),Ra,p(He,{ref_key:"uploadVersionAudienceCard",ref:Ye},null,512),F.value?(h(),m("div",La,[r("div",Pa,[ja,r("span",null,K(H.value),1)])])):k("",!0)])]),_:1},8,["visible","header"]),p(A(j),{visible:ke.value,"onUpdate:visible":n[19]||(n[19]=c=>ke.value=c),modal:!0,header:"Modifica audience",style:{width:"750px"}},{footer:C(()=>[p(i,{label:"Annulla",icon:"pi pi-times",onClick:Zt,disabled:ce.value,text:"",class:"cancel-button"},null,8,["disabled"]),p(i,{label:"Salva",icon:"pi pi-check",onClick:Yt,loading:ce.value,disabled:ce.value},null,8,["loading","disabled"])]),default:C(()=>[r("div",za,[f.value?(h(),m("div",Ba,[r("div",Ha,[Ga,r("span",Wa,K(f.value.label),1)])])):k("",!0),p(He,{ref_key:"editAudienceCard",ref:Ke},null,512)])]),_:1},8,["visible"]),p(A(j),{visible:we.value,"onUpdate:visible":n[21]||(n[21]=c=>we.value=c),modal:!0,header:"Modifica Solo anteprima",style:{width:"450px"}},{footer:C(()=>[p(i,{label:"Annulla",icon:"pi pi-times",onClick:ll,disabled:ee.value,text:"",class:"cancel-button"},null,8,["disabled"]),p(i,{label:"Salva",icon:"pi pi-check",onClick:tl,loading:ee.value,disabled:ee.value},null,8,["loading","disabled"])]),default:C(()=>[r("div",qa,[f.value?(h(),m("div",$a,[r("div",Ja,[Qa,r("span",Xa,K(f.value.label),1)])])):k("",!0),r("div",Ya,[p(A(Be),{inputId:"editFilePreviewOnly",modelValue:Ne.value,"onUpdate:modelValue":n[20]||(n[20]=c=>Ne.value=c),binary:!0,disabled:ee.value},null,8,["modelValue","disabled"]),Za]),ei])]),_:1},8,["visible"])])}}});const di=Nl(ti,[["__scopeId","data-v-ab7cb192"]]);export{di as default};

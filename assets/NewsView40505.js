import{a as j}from"./api.esm40505.js";import{o as q,u as O,c as C,af as R,r as w,a as I,b as _,l as L,e as S,f as T,h as s,z as m,C as N,A as h,j as K,m as $,w as D,g as i}from"./usetoast.esm40505.js";import{u as G}from"./useconfirm.esm40505.js";import{e as F,a as H}from"./helpers40505.js";import{u as M}from"./news40505.js";import{a as J}from"./formatData40505.js";import{_ as V}from"./_plugin-vue_export-helper40505.js";import"./utils.esm40505.js";import"./datetime40505.js";const Q={setup(){q(()=>{r.value=!0,a.value={first:0,rows:v.value.rows,sortField:null,sortOrder:null,filters:f.value},j.register("myfilter",(t,p)=>t===p),d()});const c=M(),n=O(),g=G(),o=C(()=>c.responseNews),x=C(()=>c.newsStatus),k=C(()=>n.getSelectedCountry),l=R(),v=w(),f=w({status:{value:"",matchMode:"contains"}}),r=w(!0),a=w(),y=w(0),b=w([{label:"My Filter",value:"myfilter"}]),e=w(!1),u=w({});function d(){r.value=!0;const t=new Map;t.set("country_id",k.value.id),t.set("status",f.value.status.value),t.set("page",a.value.page+1),t.set("per_page",a.value.rows),a.value.sortField&&(a.value.sortOrder==1?t.set("sorted_by",a.value.sortField+"_asc"):t.set("sorted_by",a.value.sortField+"_desc")),setTimeout(()=>{B(t)},Math.random()*1e3+250)}const B=async function(t){await c.fetchAllNews(t).then(()=>{r.value=!1}).catch(p=>{r.value=!1,F(l,p)})},P=t=>{a.value=t,d()},z=t=>{a.value=t,d()},A=()=>{a.value.page=0,a.value.filters=f.value,d()},E=(t,p)=>{g.require({target:t.currentTarget,message:"Are you sure you want to remove this news?",icon:"pi pi-exclamation-triangle",accept:()=>{U(p.id)}})},U=async function(t){await c.deleteNews(t).then(()=>{H(l,{message:"News deleted correctly.",title:""}),d()}).catch(p=>{F(l,p)})};return{dt:v,responseNews:o,filters:f,loading:r,totalRecords:y,lazyParams:a,matchModes:b,newsStatus:x,visible:e,current_news:u,onPage:P,onSort:z,onFilter:A,toggleEdit:function(t){I.push({name:"news-detail",params:{id:t.id}})},confirmDeleteNews:E,formatDataFromSql:J,loadLazyData:d,showTemplate:(t,p)=>{u.value=p,g.require({target:t.currentTarget,group:"report",message:"Did you like this content?",icon:"",acceptIcon:"",rejectIcon:""})}}}};const W={key:0},X={class:"col-12 mb-2 px-2"},Y=i("p",{class:"mb-3"},"Number of likes or dislikes",-1),Z={class:"text-color-secondary flex justify-content-between align-items-center col-8 col-offset-2"},ee={class:"flex"},te=i("i",{class:"pi like-icon mr-1"},null,-1),oe={class:"flex"},se=i("i",{class:"pi dislike-icon mr-1 mt-1"},null,-1);function ne(c,n,g,o,x,k){const l=_("Column"),v=_("Badge"),f=_("Dropdown"),r=_("Button"),a=_("DataTable"),y=_("ConfirmPopup"),b=L("tooltip");return S(),T("div",null,[s(a,{value:o.responseNews.news,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":n[0]||(n[0]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,totalRecords:o.responseNews.total,onPage:n[1]||(n[1]=e=>o.onPage(e)),onSort:n[2]||(n[2]=e=>o.onSort(e)),onFilter:n[3]||(n[3]=e=>o.onFilter()),filterDisplay:"row",removableSort:""},{empty:m(()=>[N(" No news found. ")]),default:m(()=>[s(l,{filed:"",header:"Title"},{body:m(({data:e})=>[e.translations[e.country.default_language_code].title?(S(),T("span",W,h(e.translations[e.country.default_language_code].title.text),1)):K("",!0)]),_:1}),s(l,{header:"Published at",field:"published_at",sortable:!0,style:{width:"20%"}},{body:m(({data:e})=>[N(h(o.formatDataFromSql(e.published_at)),1)]),_:1}),s(l,{header:"Status",field:"status",style:{width:"20%"},ref:"status",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:m(({data:e})=>[s(v,{value:e.status,class:$(["px-4 border-round-lg",e.status])},null,8,["value","class"])]),filter:m(({filterModel:e,filterCallback:u})=>[s(f,{modelValue:e.value,"onUpdate:modelValue":d=>e.value=d,options:o.newsStatus,optionValue:"value",optionLabel:"name",onChange:d=>u(),placeholder:"Filter by status"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),s(l,{header:"",style:{width:"14rem"}},{body:m(({data:e})=>[D(s(r,{type:"button",onClick:u=>o.toggleEdit(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil"},null,8,["onClick"]),[[b,"Edit",void 0,{top:!0}]]),D(s(r,{type:"button",onClick:u=>o.confirmDeleteNews(u,e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-trash"},null,8,["onClick"]),[[b,"Delete",void 0,{top:!0}]]),s(r,{type:"button",onClick:u=>o.showTemplate(u,e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-chart-bar"},null,8,["onClick"])]),_:1})]),_:1},8,["value","filters","loading","totalRecords"]),s(y,{group:"report",id:"report"},{message:m(()=>[i("div",X,[Y,i("div",Z,[i("div",ee,[te,N(h(o.current_news.likes),1)]),i("div",oe,[se,N(h(o.current_news.dislikes),1)])])])]),_:1}),s(y)])}const ae=V(Q,[["render",ne]]),le={setup(){const c=M();return{totalNews:C(()=>c.getTotalNews)}},components:{NewsTable:ae}},re={class:"flex justify-content-between align-items-center"},ie={class:"uppercase"};function ce(c,n,g,o,x,k){const l=_("Button"),v=_("NewsTable"),f=_("Card");return S(),T("div",null,[s(f,null,{content:m(()=>[i("div",re,[i("h1",ie,[i("span",null,h(o.totalNews)+" News",1)]),s(l,{label:"news",onClick:n[0]||(n[0]=r=>c.$router.push("/news-detail")),icon:"pi pi-plus",class:"mb-3"})]),s(v)]),_:1})])}const be=V(le,[["render",ce]]);export{be as default};

import{r as d,q as ee,af as te,u as oe,c as x,n as se,b as c,l as ae,e as C,f as S,g as a,h as n,z as m,i as le,j as L,F as ne,m as q,A as D,C as O,w as re}from"./usetoast.esm40505.js";import{e as p,a as y,s as z,h as w}from"./helpers40505.js";import{u as ie}from"./group40505.js";import{u as ce}from"./user40505.js";import{u as ue}from"./useconfirm.esm40505.js";import{w as I}from"./runtime-dom.esm-bundler40505.js";import{_ as de}from"./_plugin-vue_export-helper40505.js";const me={setup(){const N=d({icon:"pi pi-home",to:"/groups"}),r=d(""),G=d([{label:""}]),e=d({}),B=d(),V=d(!1),F=d(),b=ee(),l=te(),i=ie(),U=ce(),T=oe(),k=ue(),u=d(!1),M=d({sellout_code:{value:"",matchMode:"contains"},company_name:{value:"",matchMode:"contains"}}),h=x(()=>i.getCurrentGroup),A=x(()=>i.allGroups),t=x(()=>U.allUsers),_=x(()=>T.getSelectedCountry),f=x(()=>i.getNumUsers),g=async function(o){z(),i.fetchGroupDetail(o).then(()=>{w(),H()}).catch(s=>{w(),p(l,s)})},E=async function(){const o=new Map;await i.fetchAllGroups(o).catch(s=>{p(l,s)})},R=async function(){const o={user_group:e.value};i.updateGroup(o).then(()=>{w(),g(h.value.id+""),y(l,{message:"Group updated correctly.",title:""})}).catch(s=>{w(),p(l,s)})},P=async function(){e.value.user_group=[];const o={user_group:e.value};i.createGroup(o).then(()=>{w(),g(h.value.id+""),y(l,{message:"Group created correctly.",title:""})}).catch(s=>{w(),p(l,s)})},H=function(){var o;e.value=Object.assign({},h.value),e.value.country_id=(o=h.value.country)==null?void 0:o.id},J=function(){j(e.value.name)},Q=function(){if(V.value=!0,delete e.value.country,e.value.users&&delete e.value.users,delete e.value.created_at,delete e.value.updated_at,J(),u.value){y(l,{message:"Check that you have completed the required fields.",title:"",error:!0});return}r.value!=""&&e.value.id?R():P(),V.value=!1,z()},j=function(o){if(V.value)return o==""||o==null?u.value=!0:u.value=!1,u.value},K=async function(o){const s=new Map;o&&s.set("sellout_code",o.query),s.set("country_id",e.value.country_id),await U.fetchAllUsers(s).catch(v=>{p(l,v)})},W=async function(o){const s={group_id:e.value.id,user_group:{user_id:F.value.id}};await i.addUserToGroup(s).then(()=>{y(l,{message:"User added correctly.",title:""}),g(e.value.id+"")}).catch(v=>{p(l,v)})},X=async function(o){const s={group_id:e.value.id,user_group:{user_id:o}};await i.deleteUserFromGroup(s).then(()=>{y(l,{message:"User deleted correctly.",title:""}),g(e.value.id+"")}).catch(v=>{p(l,v)})},Y=(o,s)=>{k.require({target:o.currentTarget,message:"Are you sure you want to remove this user from the group?",icon:"pi pi-exclamation-triangle",accept:()=>{X(s)}})},Z=async function(o){const s=new FormData;s.append("file",o.files[0]);const v={group_id:e.value.id,formData:s};await i.importUsersToGroup(v).then(()=>{y(l,{message:f.value+" user uploaded.",title:""}),g(e.value.id+"")}).catch($=>{p(l,$)})};return se(async()=>{E(),K(null),r.value=b.params.id+"",r.value!=""&&r.value!="undefined"?(g(r.value),G.value[0]={label:"Edit group"}):(G.value[0]={label:"New group"},e.value.country_id=_.value.id)}),{home:N,items:G,tmp_group:e,filteredGroups:B,allGroups:A,filters:M,allUsers:t,newUser:F,saveGroup:Q,validateField:j,fetchAllGroups:E,fetchAllUsers:K,addUserToGroup:W,confirmDeleteUser:Y,importFileUsers:Z}},components:{}};const pe={class:"m-4"},_e={class:"flex justify-content-between align-items-center mb-3"},fe=a("div",{class:"flex align-items-center justify-content-between"},[a("h2",{class:"mb-2"},"GROUP DETAILS")],-1),ve={class:"formgrid grid col-10 px-0"},he={class:"field col-6"},ge=a("label",{for:"name"},"Name*",-1),ye={key:0,class:"p-error"},we={class:"field col-12"},be=a("label",{for:"note"},"Description",-1),Ue={class:"flex align-items-center justify-content-between"},xe={key:0,class:"mb-4"},Ce={key:1,class:"mb-4"},Ge={class:"flex align-items-center justify-content-between"},Ve={class:"formgrid grid col-7 px-0"},Fe={class:"field col-5 flex flex-column mb-2"},Se={class:"flex col-5 justify-content-end"},De=a("a",{href:"https://petronas-adv-test.s3-eu-west-1.amazonaws.com/template_groups_import.xlsx",class:"p-button mr-4 p-button-outlined"},[a("i",{class:"pi pi-download mr-2"}),O(" TEMPLATE ")],-1),Te={class:"flex p-4 align-items-center"},ke={class:"pl-2"};function Me(N,r,G,e,B,V){const F=c("Breadcrumb"),b=c("Button"),l=c("InputText"),i=c("Textarea"),U=c("Card"),T=c("AutoComplete"),k=c("FileUpload"),u=c("Column"),M=c("DataTable"),h=c("ConfirmPopup"),A=ae("tooltip");return C(),S(ne,null,[a("div",pe,[a("div",_e,[n(F,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"]),n(b,{label:"Save",onClick:e.saveGroup},null,8,["onClick"])]),n(U,null,{content:m(()=>[fe,a("div",ve,[a("div",he,[ge,n(l,{id:"name",type:"text",modelValue:e.tmp_group.name,"onUpdate:modelValue":r[0]||(r[0]=t=>e.tmp_group.name=t),class:q(["w-full",{"p-invalid":e.validateField(e.tmp_group.name)}])},null,8,["modelValue","class"]),e.validateField(e.tmp_group.name)?(C(),S("small",ye,"Campo obbligatorio.")):L("",!0)]),a("div",we,[be,n(i,{id:"note",modelValue:e.tmp_group.description,"onUpdate:modelValue":r[1]||(r[1]=t=>e.tmp_group.description=t),rows:"5",cols:"30",class:"w-full"},null,8,["modelValue"])])])]),_:1}),e.tmp_group.id?(C(),le(U,{key:0,class:"my-4"},{content:m(()=>[a("div",Ue,[e.tmp_group.users?(C(),S("h2",xe,D(e.tmp_group.users.length)+" USERS ",1)):(C(),S("h2",Ce,"USERS"))]),a("div",Ge,[a("div",Ve,[a("div",Fe,[n(T,{modelValue:e.newUser,"onUpdate:modelValue":r[2]||(r[2]=t=>e.newUser=t),suggestions:e.allUsers,onComplete:r[3]||(r[3]=t=>e.fetchAllUsers(t)),optionLabel:"sellout_code",emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",placeholder:"Search user by sellout code"},{item:m(t=>[a("div",null,D(t.item.full_name)+" ("+D(t.item.email)+") ",1)]),_:1},8,["modelValue","suggestions"])]),n(b,{label:"Add user",class:"p-button-outlined",onClick:e.addUserToGroup,disabled:!e.newUser},null,8,["onClick","disabled"])]),a("div",Se,[De,n(k,{mode:"basic",name:"demo",customUpload:!0,onUploader:e.importFileUsers,auto:!0,chooseLabel:"Import users",class:"p-button-outlined"},null,8,["onUploader"])])]),n(M,{value:e.tmp_group.users,paginator:!1,class:"p-datatable-customers",rows:10,dataKey:"id",rowHover:!0,filters:e.filters,"onUpdate:filters":r[4]||(r[4]=t=>e.filters=t),filterDisplay:"row"},{empty:m(()=>[O(" No users found. ")]),default:m(()=>[n(u,{field:"sellout_code",header:"Sellout code",filterMatchMode:"contains",ref:"sellout_code",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:m(({filterModel:t,filterCallback:_})=>[n(l,{type:"text",modelValue:t.value,"onUpdate:modelValue":f=>t.value=f,onKeydown:I(f=>_(),["enter"]),class:"p-column-filter",placeholder:"Filter by sellout code"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(u,{field:"company_name",header:"Company",filterMatchMode:"contains",ref:"company_name",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:m(({filterModel:t,filterCallback:_})=>[n(l,{type:"text",modelValue:t.value,"onUpdate:modelValue":f=>t.value=f,onKeydown:I(f=>_(),["enter"]),class:"p-column-filter",placeholder:"Search by company"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(u,{field:"email",header:"Email"}),n(u,{headerStyle:"width: 4rem; text-align: center",bodyStyle:"text-align: center; overflow: visible"},{body:m(({data:t})=>[re(n(b,{type:"button",onClick:_=>e.confirmDeleteUser(_,t.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-trash"},null,8,["onClick"]),[[A,"Delete",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","filters"])]),_:1})):L("",!0)]),n(h,null,{message:m(t=>[a("div",Te,[a("i",{class:q(t.message.icon),style:{"font-size":"1.5rem"}},null,2),a("p",ke,D(t.message.message),1)])]),_:1})],64)}const qe=de(me,[["render",Me]]);export{qe as default};
